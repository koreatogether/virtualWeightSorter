# mk2 문서화

이 문서는 Arduino 초급자를 위해 만들어진 설명서입니다. 이 코드는 온도 센서(ds18b20)와 블루투스(BLE)를 사용하여 온도 값을 게시하는 예제입니다.

## 1. 개요

- 이 코드는 4개의 온도 센서를 사용하여 각각의 온도 값을 읽고, 그 값을 BLE를 통해 전송합니다.
- BLE는 블루투스 저에너지(Bluetooth Low Energy)를 의미하며, 스마트폰이나 다른 기기에서 온도 정보를 받을 수 있습니다.
- 온도 센서는 DS18B20을 사용하며, 이는 1-wire 통신 방식을 사용합니다.

## 2. 사용된 부품 및 라이브러리

- **DS18B20 온도 센서**: 온도를 측정하는 센서입니다.
- **OneWire 라이브러리**: DS18B20 등 1-wire 통신을 사용하는 센서와의 통신을 돕는 라이브러리입니다.
- **DallasTemperature 라이브러리**: DS18B20 센서를 쉽게 다룰 수 있도록 도와주는 라이브러리입니다.
- **ArduinoBLE 라이브러리**: Arduino에서 블루투스 기능을 사용할 수 있도록 도와주는 라이브러리입니다.

## 3. 코드 구성 및 주요 함수 설명

### 3.1. 센서 초기화 및 설정

- `initializeSensorSystem()` 함수에서는 센서를 초기화합니다.
  - 센서의 주소를 읽고, 올바른 센서인지 확인합니다.
  - 센서의 ID를 읽어 오름차순으로 정렬합니다. (작은 값부터 큰 값으로 순서 정리)

- `readSensorAddresses()`: 각 센서의 물리적인 주소(연결된 순서를 알 수 있는 주소)를 읽습니다.
- `readSensorIDs()`: 센서마다 부여된 ID 값을 읽어옵니다. 만약 중복된 ID가 있다면 경고를 출력합니다.
- `sortSensors()`: 센서의 ID 값에 따라 순서를 정렬합니다.

### 3.2. BLE 초기화

- `initializeBLE()` 함수에서는 BLE를 초기화하고, 서비스와 특성을 등록합니다.
  - BLE 기기의 이름은 "ArduinoR4Temp"로 설정됩니다.
  - 4개의 특성을 등록하여 각 센서의 온도 값을 전송 준비합니다.
  - BLE 광고(advertise)를 시작하여 다른 기기에서 검색할 수 있도록 합니다.

### 3.3. 온도 업데이트 및 전송

- `updateBLETemperature()` 함수에서는 센서의 온도 값을 읽어 BLE 특성을 통해 전송합니다.
  - 만약 센서에서 오류가 발생하면 "ERR" 메시지를 전송합니다.

- `updateSerial()` 함수는 시리얼 모니터에 각 센서의 상태와 온도 값을 출력합니다.
  - 온도 측정 값이 정상 범위를 벗어나면 "ERR" 또는 "OVR" (오버레인지)로 표시됩니다.
  - 센서의 주소도 함께 출력하여 센서를 구분할 수 있습니다.

### 3.4. `setup()`와 `loop()`

- `setup()` 함수:
  - 시리얼 통신을 초기화합니다.
  - 센서 시스템과 BLE를 모두 초기화합니다.

- `loop()` 함수:
  - 주기적으로 시리얼 모니터에 센서 정보를 업데이트합니다.
  - BLE를 통해 온도 값을 업데이트합니다.

## 4. 사용 방법

1. Arduino 보드에 코드를 업로드합니다.
2. 시리얼 모니터를 열어 센서들의 초기화 상태와 온도 값을 확인합니다.
3. 스마트폰이나 다른 BLE 지원 기기를 통해 "ArduinoR4Temp"라는 이름의 기기를 검색합니다.
4. 연결 후 각 센서에서 읽은 온도 값이 전달되는 것을 확인할 수 있습니다.

## 5. 참고

- 이 코드에서는 4개의 온도 센서를 사용하도록 설정되어 있습니다. 만약 센서의 개수를 변경하고 싶다면, `REQUIRED_SENSOR_COUNT` 값을 수정하면 됩니다.
- 온도 센서의 측정 범위는 -55℃에서 125℃로 제한되어 있습니다. 이 범위를 벗어나는 경우 오류 메시지가 출력됩니다.
- BLE 연결 및 데이터 전송에는 약간의 딜레이가 있을 수 있습니다.

이 설명서를 통해 Arduino 초보자들도 쉽게 코드를 이해하고, 활용할 수 있기를 바랍니다.
