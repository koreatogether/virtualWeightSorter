# 키패드 잠금장치 시스템 구현 순서도

## 전체 시스템 구현 플로우차트

```mermaid
flowchart TD
    A[01_키패드잠금장치_시작코드.ino] --> B[02_암호테스트.ino]
    B --> C[03_서보모터추가.ino]
    C --> D[04_수동복귀.ino]
    D --> E[05_상용절차따라.ino]
    E --> F[06_매직넘버제거.ino]
    F --> G[07_완성코드.ino]
    G --> H[08_중복코드.ino]
    H --> I[10_비밀번호변경.ino]
    I --> J[11_잘못된입력횟수제한.ino]
    J --> K[12_eeprom.ino]
    K --> L[13_lcd.ino]
    L --> M[14_통합시스템.ino]
    M --> N[15_doxygen.ino]
    
    A -.-> A1[키패드 입력 테스트<br/>기본 이벤트 처리]
    B -.-> B1[비밀번호 검증 로직<br/>handleKeyPress 함수]
    C -.-> C1[서보모터 제어<br/>잠금 해제 메커니즘]
    D -.-> D1[수동 복귀 기능<br/>A키 입력 처리]
    E -.-> E1[부저 경고음<br/>자동 잠금 타이머]
    F -.-> F1[매직넘버 상수화<br/>코드 가독성 향상]
    G -.-> G1[millis 비동기 처리<br/>시스템 반응성 개선]
    H -.-> H1[중복코드 리팩토링<br/>openServo 함수 통합]
    I -.-> I1[관리자 모드<br/>비밀번호 변경 기능]
    J -.-> J1[보안 강화<br/>입력 횟수 제한]
    K -.-> K1[설정 저장<br/>재부팅 후 유지]
    L -.-> L1[사용자 인터페이스<br/>상태 표시]
    M -.-> M1[모든 기능 통합<br/>완전한 시스템]
    N -.-> N1[전문적 문서화<br/>배포 준비]
    
    style A fill:#e1f5fe
    style B fill:#e8f5e8
    style C fill:#fff3e0
    style D fill:#f3e5f5
    style E fill:#e0f2f1
    style F fill:#fce4ec
    style G fill:#e8eaf6
    style H fill:#f1f8e9
    style I fill:#fff8e1
    style J fill:#fce4ec
    style K fill:#e3f2fd
    style L fill:#f3e5f5
    style M fill:#e8f5e8
    style N fill:#fff3e0
```

## 기능별 구현 상세 플로우

```mermaid
flowchart LR
    subgraph "Phase 1: 기본 기능 구축"
        P1A[키패드 입력] --> P1B[암호 검증] --> P1C[서보모터 제어] --> P1D[수동 조작]
    end
    
    subgraph "Phase 2: 실용성 강화"  
        P2A[부저 경고음] --> P2B[자동 잠금] --> P2C[코드 최적화] --> P2D[리팩토링]
    end
    
    subgraph "Phase 3: 고급 기능"
        P3A[비밀번호 변경] --> P3B[보안 강화] --> P3C[데이터 저장] --> P3D[사용자 인터페이스]
    end
    
    subgraph "Phase 4: 시스템 완성"
        P4A[통합 테스트] --> P4B[문서화] --> P4C[배포 준비]
    end
    
    P1D --> P2A
    P2D --> P3A  
    P3D --> P4A
```

## 하드웨어 연결 다이어그램

```mermaid
graph TD
    subgraph "아두이노 우노"
        MCU[Arduino Uno<br/>메인 컨트롤러]
    end
    
    subgraph "입력 장치"
        KEYPAD[4x4 키패드<br/>핀 2-9]
    end
    
    subgraph "출력 장치" 
        SERVO[서보모터<br/>핀 10]
        BUZZER[부저<br/>핀 11]
        LCD[LCD 디스플레이<br/>핀 A4, A5<br/>I2C 통신]
    end
    
    subgraph "저장장치"
        EEPROM[내장 EEPROM<br/>설정 저장]
    end
    
    MCU --> KEYPAD
    MCU --> SERVO
    MCU --> BUZZER
    MCU --> LCD
    MCU --> EEPROM
    
    style MCU fill:#4CAF50
    style KEYPAD fill:#2196F3  
    style SERVO fill:#FF9800
    style BUZZER fill:#F44336
    style LCD fill:#9C27B0
    style EEPROM fill:#607D8B
```

## 소프트웨어 아키텍처

```mermaid
classDiagram
    class KeypadManager {
        +handleKeyPress()
        +readKeyInput()
        +validateInput()
    }
    
    class PasswordManager {
        +checkPassword()
        +changePassword()  
        +resetToDefault()
        +saveToEEPROM()
    }
    
    class ServoController {
        +openLock()
        +closeLock()
        +setAutoTimer()
    }
    
    class SecurityManager {
        +trackFailedAttempts()
        +enforceTimeout()
        +resetCounter()
    }
    
    class DisplayManager {
        +showStatus()
        +showMessage()
        +updateDisplay()
    }
    
    class SystemManager {
        +initialize()
        +mainLoop()
        +handleStates()
    }
    
    KeypadManager --> PasswordManager
    PasswordManager --> ServoController
    SecurityManager --> DisplayManager
    SystemManager --> KeypadManager
    SystemManager --> SecurityManager
    SystemManager --> DisplayManager
```

## 상태 다이어그램

```mermaid
stateDiagram-v2
    [*] --> Standby : 시스템 초기화
    
    Standby --> InputMode : 키 입력 감지
    InputMode --> Validating : 암호 길이 충족
    InputMode --> InputMode : 숫자 키 입력
    InputMode --> AdminMode : B키 + 관리자 암호
    
    Validating --> Unlocked : 암호 일치
    Validating --> Failed : 암호 불일치
    Validating --> Standby : 입력 초기화
    
    Unlocked --> AutoLocking : 5초 타이머 시작
    AutoLocking --> Standby : 자동 잠금 완료
    Unlocked --> Standby : A키 수동 잠금
    
    Failed --> Blocked : 3회 연속 실패
    Failed --> Standby : 경고음 후 복귀
    
    Blocked --> Standby : 30초 후 해제
    
    AdminMode --> PasswordChange : 새 암호 입력
    PasswordChange --> Standby : 변경 완료
    AdminMode --> Standby : C키 취소
```

## 구현 우선순위 매트릭스

```mermaid
quadrantChart
    title 기능 구현 우선순위
    x-axis Low Complexity --> High Complexity
    y-axis Low Priority --> High Priority
    
    quadrant-1 나중에 구현
    quadrant-2 우선 구현  
    quadrant-3 빠른 구현
    quadrant-4 신중한 구현
    
    키패드 입력: [0.2, 0.9]
    암호 검증: [0.3, 0.9]
    서보 제어: [0.4, 0.8]
    자동 잠금: [0.6, 0.7]
    비동기 처리: [0.7, 0.8]
    비밀번호 변경: [0.8, 0.6]
    입력 횟수 제한: [0.6, 0.5]
    EEPROM 저장: [0.7, 0.4]
    LCD 표시: [0.8, 0.3]
    문서화: [0.3, 0.2]
```

## 나만의 시스템 구현 순서도 (grok code fast )

기존의 단계별 파일 기반 접근에서 벗어나, 사용자 중심의 개발 라이프사이클 관점에서 재구성한 순서도입니다.

```mermaid
flowchart TD
    A[요구사항 분석<br/>사용자 니즈 파악] --> B[시스템 설계<br/>아키텍처 및 인터페이스 설계]
    B --> C[하드웨어 구성<br/>키패드, 서보, LCD 연결]
    C --> D[코어 기능 구현<br/>키 입력 및 검증]
    D --> E[보안 기능 추가<br/>비밀번호 변경 및 실패 제한]
    E --> F[사용자 경험 개선<br/>자동 잠금 및 피드백]
    F --> G[데이터 영속성<br/>EEPROM 설정 저장]
    G --> H[통합 및 최적화<br/>코드 리팩토링]
    H --> I[테스트 및 검증<br/>단위 및 통합 테스트]
    I --> J[문서화 및 배포<br/>Doxygen 및 사용자 가이드]
    
    A -.-> A1[사용자 시나리오<br/>잠금/해제 프로세스]
    B -.-> B1[모듈 분리<br/>Manager 클래스 설계]
    C -.-> C1[핀 매핑<br/>하드웨어 인터페이스]
    D -.-> D1[이벤트 처리<br/>비동기 로직 구현]
    E -.-> E1[보안 정책<br/>재시도 제한 및 타임아웃]
    F -.-> F1[피드백 시스템<br/>부저 및 LCD 표시]
    G -.-> G1[설정 관리<br/>재부팅 후 상태 유지]
    H -.-> H1[성능 최적화<br/>메모리 및 응답성 개선]
    I -.-> I1[에지 케이스 테스트<br/>보안 취약점 검증]
    J -.-> J1[유지보수 가이드<br/>확장성 고려]
    
    style A fill:#e3f2fd
    style B fill:#f3e5f5
    style C fill:#e8f5e8
    style D fill:#fff3e0
    style E fill:#fce4ec
    style F fill:#e0f2f1
    style G fill:#e8eaf6
    style H fill:#f1f8e9
    style I fill:#fff8e1
    style J fill:#e1f5fe
```

### 주요 차별점
- **사용자 중심 접근**: 실제 사용자 경험을 우선 고려
- **보안 우선 설계**: 초기 단계부터 보안 메커니즘 통합
- **확장성 고려**: 미래 기능 추가를 위한 모듈화
- **지속적 개선**: 테스트와 피드백 루프 포함