# 05_combine_LCD 시나리오

## 개요
키패드, 서보모터, LCD 디스플레이, 부저를 통합한 보안 시스템의 시나리오입니다. LCD를 통한 사용자 피드백과 백라이트 관리 기능이 포함되어 있습니다.

## 하드웨어 구성

### 핀 연결
- **키패드 (4x4)**: 행 핀 9,8,7,6 / 열 핀 5,4,3,2
- **서보모터**: 핀 10
- **수동 해제 버튼**: 핀 11 (INPUT_PULLUP)
- **부저**: 핀 12
- **LCD**: I2C 연결 (SDA/SCL)

### 하드웨어 설정값
- **서보모터 각도**: 잠금 0도, 해제 180도
- **LCD**: 16x2 I2C LCD with hd44780 library
- **키패드 배열**:
  ```
  1 2 3 A
  4 5 6 B
  7 8 9 C
  * 0 # D
  ```

## 시스템 상태

### 모드 정의
1. **IDLE**: 정상 대기 상태
2. **SECURITY_LOCKDOWN**: 보안 잠금 상태

### 시간 상수
- **UNLOCK_DURATION**: 5초 (자동 잠금)
- **LOCKDOWN_DURATION**: 120초 (2분 보안 잠금)
- **BUZZER_DURATION**: 60초 (부저 동작)
- **PASSWORD_ENTRY_TIMEOUT**: 10초 (비밀번호 입력 타임아웃)
- **BACKLIGHT_DURATION**: 10초 (백라이트 자동 꺼짐)

## 테스트 시나리오

### 1. 시스템 초기화 시나리오
**목표**: 시스템 부팅 및 초기 상태 확인

**테스트 단계**:
1. Arduino 전원 연결
2. Serial Monitor 확인 (9600 baud)
3. LCD 초기화 상태 확인
4. 서보모터 잠금 상태 확인 (0도)

**예상 결과**:
- Serial: "Keypad Servo LCD Lock System Started"
- LCD 첫 줄: "Security Lock"
- LCD 둘째 줄: "Ready"
- 백라이트 자동 켜짐
- 서보모터 잠금 위치 (0도)

### 2. 정상 비밀번호 입력 시나리오
**목표**: 올바른 비밀번호로 도어 해제

**테스트 단계**:
1. `*` 키 입력 → 비밀번호 입력 모드 시작
2. `123456` 입력 (각 숫자마다 `*` 표시)
3. `#` 또는 `*` 키로 종료

**예상 결과**:
- LCD 첫 줄: "Password Entry"
- LCD 둘째 줄: "Enter: ******" (진행에 따라 별표 증가)
- 성공 시:
  - Serial: "Correct password entered"
  - LCD: "Access Granted" / "Door Unlocked"
  - 서보모터 180도 회전 (해제)
  - 5초 후 자동 잠금
  - 백라이트 켜짐 유지

### 3. 잘못된 비밀번호 시나리오
**목표**: 틀린 비밀번호 입력 시 실패 카운트 관리

**테스트 단계**:
1. `*` 키 입력
2. 잘못된 6자리 숫자 입력 (예: `111111`)
3. `#` 키로 종료
4. 실패 횟수 확인

**예상 결과**:
- Serial: "Wrong password"
- LCD 첫 줄: "Wrong Password"
- LCD 둘째 줄: "Attempts: 1/5" (실패 횟수 표시)
- 3초간 메시지 표시 후 IDLE 모드 복귀

### 4. 최대 실패 횟수 초과 시나리오
**목표**: 5회 실패 시 보안 잠금 활성화

**테스트 단계**:
1. 5회 연속 잘못된 비밀번호 입력
2. 보안 잠금 모드 활성화 확인
3. 타이머 카운트다운 확인

**예상 결과**:
- 5회째 실패 시:
  - Serial: "Maximum attempts exceeded - security lockdown activated"
  - LCD 첫 줄: "Security Lockdown"
  - LCD 둘째 줄: "LOCKED 2m 0s" (카운트다운)
  - 부저 1초 간격으로 60초간 동작
  - 백라이트 계속 켜짐
  - 120초 후 자동 해제

### 5. 수동 해제 버튼 시나리오
**목표**: 물리적 버튼을 통한 수동 해제

**테스트 단계**:
1. 정상 상태에서 수동 버튼 누르기
2. 보안 잠금 상태에서 수동 버튼 누르기

**예상 결과**:
- 정상 상태:
  - Serial: "Manual unlock activated"
  - LCD: "Manual Unlock" / "Activated"
  - 서보모터 해제 (180도)
  - 백라이트 켜짐
- 보안 잠금 상태:
  - Serial: "Manual unlock disabled - security lockdown active"
  - LCD: "Manual Unlock" / "Disabled"
  - 서보모터 동작 없음

### 6. 비밀번호 입력 타임아웃 시나리오
**목표**: 10초 내 입력하지 않을 시 타임아웃 처리

**테스트 단계**:
1. `*` 키 입력으로 비밀번호 모드 시작
2. 부분 입력 후 10초 대기
3. 타임아웃 처리 확인

**예상 결과**:
- 6자리 완성된 경우: 자동으로 `#` 추가하여 처리
- 미완성된 경우:
  - Serial: "Input timeout - buffer cleared"
  - LCD: "Timeout" / "Try Again"
  - 2초간 메시지 표시 후 초기화

### 7. 백라이트 관리 시나리오
**목표**: 자동 백라이트 제어 동작 확인

**테스트 단계**:
1. 시스템 대기 상태에서 10초 대기
2. 키 입력 시 백라이트 켜짐 확인
3. 특수 상태에서 백라이트 유지 확인

**예상 결과**:
- IDLE 상태: 10초 후 백라이트 자동 꺼짐
- 비밀번호 입력 중: 백라이트 계속 켜짐
- 보안 잠금 상태: 백라이트 계속 켜짐
- 언락 상태: 백라이트 계속 켜짐

### 8. 자동 잠금 시나리오
**목표**: 해제 후 5초 자동 잠금 동작 확인

**테스트 단계**:
1. 정상 비밀번호로 해제
2. LCD 카운트다운 표시 확인
3. 5초 후 자동 잠금 확인

**예상 결과**:
- 해제 즉시:
  - LCD: "Access Granted" / "UNLOCKED 5s"
  - 카운트다운: "UNLOCKED 4s", "UNLOCKED 3s" ...
- 5초 후:
  - Serial: "Auto lock activated"
  - LCD: "Auto Lock" / "Activated"
  - 서보모터 잠금 위치 (0도)

### 9. 잘못된 형식 입력 시나리오
**목표**: 비정상 입력 형식 처리 확인

**테스트 단계**:
1. `*` 없이 숫자 입력
2. 6자리 미만으로 `#` 입력
3. 8자리 초과 입력

**예상 결과**:
- 모든 경우:
  - Serial: "Invalid input format" 또는 "Invalid Input"
  - LCD: "Invalid Format" / "Try Again" 또는 "Invalid Input" / "Try Again"
  - 2초간 메시지 표시 후 초기화

### 10. 시스템 복구 시나리오
**목표**: 보안 잠금 해제 후 정상 동작 복귀

**테스트 단계**:
1. 보안 잠금 상태에서 120초 대기
2. 자동 해제 확인
3. 정상 비밀번호 입력 테스트

**예상 결과**:
- 120초 후:
  - Serial: "Security lockdown released - normal operation resumed"
  - LCD: "Lockdown End" / "System Ready"
  - 부저 정지
  - 실패 카운트 초기화 (failureCount = 0)
  - 정상 비밀번호 입력 가능

## 디버깅 포인트

### Serial Monitor 출력 확인 사항
- 시스템 시작 메시지
- 키 입력 시 `*` 표시
- 비밀번호 검증 결과
- 모드 전환 메시지
- 타이머 관련 메시지

### LCD 표시 상태 확인
- 메시지 업데이트 주기 (500ms)
- 백라이트 자동 제어
- 카운트다운 표시 정확성
- 특수 문자 표시 (`*` 마스킹)

### 하드웨어 동작 확인
- 서보모터 각도 정확성
- 부저 동작 패턴 (1초 간격)
- 버튼 디바운싱 (200ms)
- 키패드 입력 디바운싱

## 성능 최적화 사항

### 메모리 관리
- String 객체 사용 최소화
- 불필요한 delay() 대신 millis() 활용
- LCD 업데이트 주기 제한 (500ms)

### 타이밍 정확성
- 모든 지연시간을 non-blocking으로 처리
- 멀티태스킹 구조로 각 기능 독립 동작
- 디바운싱으로 중복 입력 방지

이 시나리오를 통해 LCD 통합 키패드 잠금 시스템의 모든 기능을 체계적으로 검증할 수 있습니다.