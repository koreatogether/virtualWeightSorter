# DS18B20 시스템 메뉴 구성 및 흐름 상세 설명

이 문서는 본 저장소의 DS18B20 센서 관리 시스템에서 제공하는 메뉴 구조와 각 메뉴/서브메뉴의 이동 흐름을 AI 및 개발자에게 명확히 설명하기 위해 작성되었습니다.

---

## 1. 전체 메뉴 진입 구조

- 시스템은 시리얼 명령어(`menu` 또는 `m`) 입력 시, 센서 ID 관리 메뉴(메인 메뉴)로 진입합니다.
- 메인 루프에서 항상 시리얼 입력을 감지하며, 명령어에 따라 메뉴 진입 또는 일반 동작을 수행합니다.
- 메뉴 진입 시, App 클래스의 상태(`AppState`)가 `MENU_ACTIVE`로 변경되어 메뉴 전용 입력 루프로 전환됩니다.

## 2. 메인 메뉴(센서 ID 변경 메뉴) 구조

메뉴 진입 시 아래와 같은 항목이 표시됩니다:

1. Change Individual Sensor ID (개별 센서 ID 변경)
2. Change Selective Sensor IDs (복수 센서 ID 선택 변경)
3. Auto-assign IDs by Address (주소순 자동 ID 할당)
4. Reset All Sensor IDs (전체 센서 ID 초기화)
5. Cancel (메뉴 취소 및 일반 모드 복귀)
6. Threshold Settings (임계값 설정 메뉴 진입)

- 각 항목은 1~6 중 하나의 숫자를 입력하여 선택합니다.
- 60초간 입력이 없으면 자동으로 일반 모드로 복귀합니다.

## 3. 각 소메뉴별 상세 흐름

### 3.1 Change Individual Sensor ID
- 센서 테이블이 출력되고, 변경할 센서 번호(1~N)를 입력받음
- 0 입력 시 취소 및 메인 메뉴 복귀
- 센서 선택 후, 새 ID(1~N, 미사용 ID)를 입력받아 적용
- 성공 시 일반 모드로 복귀 및 센서 테이블 갱신

### 3.2 Change Selective Sensor IDs
- 센서 테이블이 출력되고, 변경할 센서 번호들을 공백/쉼표로 구분해 입력받음 (예: 1 3 5)
- 0 입력 시 취소 및 메인 메뉴 복귀
- 선택 센서 목록 확인 후, 각 센서별 새 ID를 순차적으로 입력받아 적용
- 완료 시 일반 모드로 복귀 및 센서 테이블 갱신

### 3.3 Auto-assign IDs by Address
- 연결된 센서의 주소를 기준으로 오름차순 정렬 후, 1~N까지 ID를 자동 할당
- 완료 메시지 출력 후 일반 모드로 복귀

### 3.4 Reset All Sensor IDs
- 모든 센서의 ID를 0으로 초기화
- 완료 메시지 및 비정상 센서 목록 출력 후 일반 모드로 복귀

### 3.5 Threshold Settings (임계값 설정 메뉴)
- 임계값 설정 서브메뉴로 진입
- 서브메뉴 항목:
    1. Set Individual Threshold (개별 센서 임계값)
    2. Set Global Threshold (전체 센서 임계값)
    3. View Current Thresholds (현재 임계값 보기)
    4. Clear Thresholds (임계값 초기화)
    5. Back to Main Menu (메인 메뉴 복귀)
- 각 항목은 1~5 중 하나의 숫자를 입력하여 선택
- 60초간 입력이 없으면 자동으로 일반 모드로 복귀

#### 3.5.1 Set Individual Threshold
- 센서 목록 출력 후, 센서 번호 입력 → 임계값(상한/하한) 입력
- 입력값 검증 후 적용, 완료 시 임계값 테이블 갱신 및 서브메뉴 복귀

#### 3.5.2 Set Global Threshold
- 전체 센서에 적용할 상한/하한 임계값 입력
- 입력값 검증 후 일괄 적용, 완료 시 서브메뉴 복귀

#### 3.5.3 View Current Thresholds
- 각 센서별 현재 임계값을 테이블로 출력
- 서브메뉴로 복귀

#### 3.5.4 Clear Thresholds
- 모든 센서의 임계값을 기본값으로 초기화
- 서브메뉴로 복귀

#### 3.5.5 Back to Main Menu
- 메인 메뉴로 복귀

### 3.6 Cancel
- 메뉴를 즉시 종료하고 일반 모드로 복귀

---

## 4. 상태 전이 요약 (AppState 기반)

- NORMAL_OPERATION (일반 동작)
    - 'menu'/'m' 입력 → MENU_ACTIVE
- MENU_ACTIVE (메뉴 대기)
    - 1 → EDIT_INDIVIDUAL_ID
    - 2 → EDIT_SELECTIVE_ID
    - 3 → AUTO_ASSIGN_IDS
    - 4 → RESET_ALL_IDS
    - 5 → NORMAL_OPERATION
    - 6 → THRESHOLD_MENU
- THRESHOLD_MENU (임계값 메뉴)
    - 1 → SET_INDIVIDUAL_THRESHOLD
    - 2 → SET_GLOBAL_THRESHOLD
    - 3/4/5 → 각 기능 실행 후 THRESHOLD_MENU 또는 MENU_ACTIVE로 복귀
- 각 서브상태에서 취소/타임아웃 시 NORMAL_OPERATION 또는 상위 메뉴로 복귀

---

## 5. 기타
- 모든 메뉴/서브메뉴는 입력 대기 중 60초(기본) 타임아웃이 있으며, 타임아웃 시 자동으로 일반 모드로 복귀합니다.
- 메뉴/서브메뉴 진입 및 복귀 시 센서 테이블, 임계값 테이블 등 관련 정보가 자동 출력됩니다.

---

이 문서는 AI 및 개발자가 DS18B20 시스템의 메뉴 구조와 상태 전이, 사용자 입력 흐름을 빠르게 파악할 수 있도록 설계되었습니다.
