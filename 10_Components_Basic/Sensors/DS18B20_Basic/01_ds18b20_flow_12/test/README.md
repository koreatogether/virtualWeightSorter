# 펌웨어 유닛 테스트 절차

이 문서는 Arduino 프로젝트의 C++ 코드에 대한 유닛 테스트를 설정하고 실행하는 방법을 안내합니다.

## 1. 유닛 테스트란?

유닛 테스트는 코드의 가장 작은 단위(함수 또는 메소드)가 예상대로 정확하게 동작하는지 검증하는 자동화된 테스트입니다. 이를 통해 코드 변경 시 발생할 수 있는 문제를 사전에 발견하고, 코드의 안정성과 신뢰성을 높일 수 있습니다.

## 2. 테스트 환경 설정

이 프로젝트에서는 C++를 위한 간단한 테스트 프레임워크인 **Unity**를 사용합니다.

### 2.1. Unity 다운로드

1.  [Unity GitHub 저장소](https://github.com/ThrowTheSwitch/Unity)로 이동합니다.
2.  `Code` 버튼을 클릭하고 `Download ZIP`을 선택하여 소스 코드를 다운로드합니다.
3.  압축을 해제하고, 내부의 `src` 폴더와 `extras/fixture/src` 폴더의 내용을 `test/unity` 디렉토리에 복사합니다.

### 2.2. Mocking을 위한 FakeArduino 생성

Arduino 코드는 하드웨어와 관련된 함수(`Serial.print`, `digitalWrite` 등)를 포함하고 있어 일반 PC 환경에서 컴파일하거나 테스트하기 어렵습니다. 이를 해결하기 위해 실제 Arduino 함수인 것처럼 동작하는 **가짜(Fake) Arduino 라이브러리**를 만듭니다.

-   `test/FakeArduino.h` 파일에 테스트에 필요한 Arduino 함수들을 선언합니다. 예를 들어, `Serial.print`는 콘솔에 출력하도록 재정의할 수 있습니다.

## 3. 테스트 작성 및 실행

### 3.1. 테스트 대상 선정

유닛 테스트는 **Arduino 프레임워크에 대한 의존성이 적은 순수 C++ 로직**에 가장 적합합니다. 예를 들어, `Utils.cpp`의 `addrToString` 함수는 입력값에 따라 정해진 문자열을 생성하므로 테스트하기 좋은 대상입니다.

### 3.2. 테스트 케이스 작성 (`test_main.cpp`)

1.  **테스트할 함수 선언:** 테스트하려는 함수의 헤더(`Utils.h`)를 포함시킵니다.
2.  **Unity 헤더 포함:** `unity.h`를 포함시킵니다.
3.  **테스트 함수 작성:** `void test_...()` 형태의 함수를 만들고, 내부에 `TEST_ASSERT_EQUAL_STRING()`과 같은 Unity 매크로를 사용하여 예상 결과와 실제 결과가 같은지 검증합니다.
4.  **`main` 함수 작성:**
    -   `UNITY_BEGIN()`으로 테스트를 시작합니다.
    -   `RUN_TEST(test_...)`로 작성한 테스트 함수를 실행합니다.
    -   `UNITY_END()`로 테스트를 마칩니다.

### 3.3. 컴파일 및 실행

테스트는 PC의 C++ 컴파일러(g++)를 사용하여 빌드하고 실행합니다.

```bash
# g++를 사용하여 테스트 코드와 소스 코드를 함께 컴파일
# -I 옵션으로 헤더 파일이 있는 디렉토리를 포함시킵니다.
g++ -o test_runner test/test_main.cpp Utils.cpp test/unity/unity.c -I. -Itest/unity

# 컴파일된 테스트 실행 파일을 실행
./test_runner
```

### 3.4. 결과 확인

실행 결과, 모든 테스트가 통과하면 다음과 같은 메시지가 출력됩니다.

```
-----------------------
1 Tests 0 Failures 0 Ignored
OK
```

만약 테스트가 실패하면, 실패한 위치와 이유가 자세히 표시됩니다.

## 4. 향후 방향

-   **테스트 자동화:** `Makefile`이나 `CMake`와 같은 빌드 시스템을 도입하여 컴파일 및 실행 과정을 자동화할 수 있습니다.
-   **CI/CD 연동:** GitHub Actions와 같은 CI/CD 도구와 연동하여, 코드 변경사항이 푸시될 때마다 자동으로 유닛 테스트를 실행하도록 구성할 수 있습니다.
