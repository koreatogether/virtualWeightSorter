# Project Progress Log - 3D 출력 생산 관리 사이트

이 문서는 프로젝트 진행 중 발생하는 주요 변경 사항, 기능 추가 및 결정 사항을 날짜별로 기록합니다.

## [2026-02-11] 
### 오후 1:15 - 프린터 자산 관리 및 입력 편의 기능 추가
- **프린터 자산 관리 기능 구현**:
    - 프린터 추가/삭제 기능.
    - 구입일(Purchase Date) 기록 및 현재 날짜 기준 경과일(D+일) 자동 계산 표시.
    - 수리일 기록을 위한 데이터 구조(Schema) 확장.
- **출력 대상명 자동완성(Datalist) 도입**:
    - 기존에 입력했던 출력물 이름을 최신순으로 드롭다운 목록에 표시.
    - 중복 제거 및 최신 데이터 우선 로직 적용.
- **API 엔드포인트 확장**:
    - `/api/v1/printers` (POST, DELETE)
    - `/api/v1/tasks/history` (GET)

### 오후 1:05 - AI 친화적 타임라인(간트) 뷰 구현
- **시각화 레이아웃 추가**:
    - HTML `<table>`과 CSS Grid를 활용한 타임라인 뷰 구현.
    - 에이전트가 데이터 구조를 즉시 파악할 수 있는 시맨틱 마크업 준수.
- **상태 연동**: 타임라인 상에서 출력 성공/불량 여부를 색상으로 구분.

### 오후 12:55 - 데이터 입력 및 상태 관리 기초 구현
- **입력 폼 추가**: 출력 예약 및 필라멘트 재고 등록 기능.
- **상태 업데이트**: 출력물별 [성공]/[불량] 버튼을 통한 실시간 상태 반영.
- **대시보드 통계**: 총 작업 수, 불량 합계 등을 실시간 계산하여 표시.

### 오전 11:30 - 프로젝트 초기화 및 설계
- **기본 폴더 구조 생성**: `00_Management` 템플릿 기반 구조 확립.
- **기술 스택 확정**: Python Flask (Backend) + JSON (DB) + Vanilla JS (Frontend).
- **요구사항 분석**: 3D 출력물 일정 및 수량 관리를 위한 설문 진행 및 데이터 스키마 정의.
- **AI 친화적 설계 원칙 수립**: Pure HTML 기반의 시맨틱 태그 및 REST API 중심 통신.

### 오후 1:25 - 데이터 저장 안정화 및 백엔드 로직 보강
- **절대 경로 기반 DB 접근**: 서버 실행 위치에 상관없이 `db.json`을 정확히 찾아 읽고 쓰도록 수정.
- **데이터 무결성 보장**: 
    - 일정 등록 시 필수 필드(ID, 상태, 생성일자) 자동 생성 로직 추가.
    - JSON 파싱 에러 발생 시 초기 데이터로 복구하는 예외 처리 추가.
- **Frontend 비동기 처리 개선**: 
    - `postData` 이후 서버 응답을 `await`로 확인하고 `fetchData`를 호출하여 화면 갱신 동기화.
    - 데이터가 없을 때의 UI 처리(테이블 내 안내 문구) 추가.
- **날짜 계산 로직 정밀화**: 구입일 기준 경과일 계산 시 시간 단위를 제외한 날짜 중심 계산 적용.

### 오후 3:30 - 프린터 가용 일정 시각화 (Flatpickr 도입)
- **달력 UI 고도화**:
    - Flatpickr 라이브러리를 도입하여 HTML 기본 날짜 입력기의 시각적 한계 극복.
- **가용성 시각화 로직**:
    - 프린터 선택 시, 해당 장비의 기존 일정(Busy Dates)을 서버에서 조회.
    - 달력 팝업 내에서 **예약된 날짜는 회색으로 비활성화** 처리하여 중복 선택 원천 차단.
    - **선택 가능 날짜는 녹색** 톤으로 스타일링하여 가용성 직관적 파악 가능.
- **모드별 UI 최적화**:
    - 자동 계획 모드: 날짜 선택만 가능 (`YYYY-MM-DD`).
    - 수동 할당 모드: 시간까지 선택 가능 (`YYYY-MM-DD HH:mm`).

### 오후 3:15 - 생산 일정 리스트 가독성 및 정렬 개선
- **날짜 중심 정렬**: 모든 생산 계획을 날짜순(오름차순)으로 자동 정렬하여 공정 흐름 가시성 확보.
- **생산품별 시각적 분리**: 
    - 리스트 출력 중 생산품(주문)이 변경될 때마다 회색 구분 행(`product-separator`)을 삽입하여 그룹화.
- **2줄 레이아웃 적용**:
    - 한 행 내에서 제품명/재질, 계획/실적 수량 등을 2줄로 배치하여 정보를 더 여유롭게 표시.
- **컬럼 재배치**: 사용자 요청에 따라 날짜를 최우측에서 최좌측으로 이동 및 관리 버튼 배치 최적화.

### 오후 2:55 - 주문 등록 UI 개선 및 필라멘트 선택 자동화
- **입력 편의성 강화**: 
    - 주문 등록 시 '기존 재고 수량' 칸에 placeholder 안내 문구 추가 및 기본값(`0`) 제거.
    - 재질 및 색상을 텍스트 입력 대신 **현재 보유 재고 목록**에서 선택할 수 있도록 드롭다운(Select) 방식으로 변경.
- **동적 데이터 바인딩**: 재고가 추가되거나 수정되면 주문 등록/수정 창의 필라멘트 목록도 실시간으로 동기화됨.

### 오후 2:45 - 필라멘트 소요량 예측 및 부족 경고 시스템
- **주문 상세 정보 확장**: 주문 등록 시 `재질(Material)`, `색상(Color)`, `개당 무게(Unit Weight)` 정보를 입력.
- **소요량 자동 계산**: 
    - `주문별 필요량` = (목표 수량 - 확보 수량) × 개당 무게.
    - 주문 카드에 '추가 필요 필라멘트 양' 표시.
- **재고 부족 경고**:
    - 동일한 재질/색상을 사용하는 모든 진행 중인 주문의 총 필요량을 합산.
    - 현재 보유 재고가 필요량보다 적을 경우, 재고 리스트에 **주황색 배경**과 함께 **부족 수량(필요량)**을 빨간색 텍스트로 표시.

### 오후 2:35 - 필라멘트 재고 및 프린터 자산 수정 기능 추가
- **관리 편의성 강화**: 등록된 필라멘트 재고 정보(재질, 색상, 무게)와 프린터 정보(모델, 식별번호, 구입일)를 언제든 수정할 수 있는 기능 추가.
- **삭제 기능 보강**: 불필요한 재고 항목을 삭제할 수 있는 API 및 UI 연동.
- **UI 일관성**: 주문 수정과 동일하게 오버레이 팝업 형태의 수정 인터페이스 적용.

### 오후 2:25 - 프린터 중복 할당 감지(Conflict Detection) 및 자산 ID 추가
- **프린터 식별 강화**: 기존 모델명 외에 고유 식별 번호(`asset_id`) 필드 추가 (예: P2SC-101).
- **중복 할당 경고 로직**:
    - 동일 프린터가 같은 날짜에 여러 개의 스케줄을 가질 경우, 시스템이 이를 감지하여 경고 발생.
    - 자동 계획 생성(`Auto-Schedule`) 시에도 중복 날짜를 감지하여 결과 메시지에 리포트.
- **UI 시각화**: 중복된 스케줄 행은 주황색 배경(`warning-color`)으로 표시되며, '[중복!]' 태그가 붙음.

### 오후 2:15 - 주문 수정(Order Edit) 기능 추가
- **주문 정보 업데이트**: 이미 등록된 주문의 제품명, 목표 수량, 기존 재고, 마감 기한을 수정할 수 있는 기능 추가.
- **상태 재계산 로직**: 목표 수량이나 기존 재고 수정 시, 현재까지의 생산 실적과 비교하여 주문 상태(진행중/완료)를 자동으로 재설정.
- **UI 구현**: 각 주문 카드에 '수정' 버튼 추가 및 오버레이 형태의 수정 폼 구현.

### 오후 2:05 - 주문별 기존 재고(Initial Stock) 반영 기능 추가
- **기존 재고 관리**: 주문 등록 시 '기존 재고 수량'을 입력할 수 있도록 필드 추가.
- **계산 수식 고도화**:
    - **잔여 생산 필요량** = 목표 수량 - 기존 재고 - 누적 생산 실적.
    - **전체 확보량** = 기존 재고 + 생산 실적.
- **자동 스케줄링 연동**: 자동 계획 생성 시, 목표 수량에서 기존 재고를 제외한 '진짜 필요한 생산량'만큼만 일정을 생성하도록 API 로직 수정.
- **UI 업데이트**: 주문 카드에 (재고 + 생산) 합산 정보를 상세히 표시하여 직관적인 현황 파악 가능.

### 오후 1:55 - 생산 계획 자동 생성(Auto-Scheduling) 기능 추가
- **기능 개요**: 시작일과 일일 목표 생산량(Capa)을 입력하면, 주문의 잔여 수량을 채울 때까지의 일별 생산 계획을 자동으로 계산하여 일괄 생성.
- **백엔드 로직**: 
    - `/api/v1/schedules/auto` 엔드포인트 신설.
    - 잔여 수량(`remaining_qty`)이 0이 될 때까지 루프를 돌며 일별 계획 생성.
    - 마지막 날짜는 남은 수량만큼만 할당.
- **UI/UX**: 
    - [자동 계획 생성 모드] 체크박스를 통해 단일 등록/일괄 등록 UI 전환.
    - 완료 후 생성된 계획 개수 알림 팝업 제공.

### 오후 1:45 - 생산 계획 삭제 기능 추가
- **삭제 버튼 및 확인 팝업**: 생산 일정 리스트에 [삭제] 버튼 추가 및 삭제 시 확인 팝업(`confirm`) 연동.
- **실적 연동 삭제**: 특정 일정을 삭제하면 해당 일정이 기여했던 주문의 '누적 완료 수량'이 자동으로 차감되어 계산되도록 백엔드 로직 보강.

### 오후 1:35 - 생산 관리 시스템 (MES Lite) 구조 개편
- **주문(Order) 중심 아키텍처 도입**:
    - 전체 생산 목표를 정의하는 '주문'과 실행 단위인 '일정'으로 계층화.
    - 주문 카드 UI: 목표, 완료, 잔여 수량 및 진행률 바 시각화.
- **실적 기반 자동 계산**:
    - 일일 생산 실적 입력 시 주문의 잔여 수량이 자동으로 차감되는 수식 적용.
- **데이터 마이그레이션**: 기존 `schedules` 구조에 `order_id`와 `actual_quantity` 필드 추가.

---
*Next Step: 사진 업로드 기능 또는 상세 통계 리포트 구현 예정*
