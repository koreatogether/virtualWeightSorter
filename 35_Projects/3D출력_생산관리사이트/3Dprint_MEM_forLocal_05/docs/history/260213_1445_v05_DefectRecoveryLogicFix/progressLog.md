# Project Progress Log - 3D 출력 생산 관리 사이트

이 문서는 프로젝트 진행 중 발생하는 주요 변경 사항, 기능 추가 및 결정 사항을 날짜별로 기록합니다.

## [2026-02-11] 
### 오후 1:25 - 무게 입력 데이터 타입 변경 (정수 -> 소수점 2자리)
- **무게 데이터 처리 고도화**:
    - 주문 생성 및 수정 시 '개당 무게(g)' 필드에 소수점 입력 허용 (`int` -> `float`).
    - 재고 관리 및 수정 시 '잔량(g)' 필드에 소수점 입력 허용.
    - 프론트엔드 입력 필드(`input type="number"`)에 `step="0.01"` 속성 추가.
    - 자바스크립트 데이터 파싱 로직을 `parseInt`에서 `parseFloat`으로 변경.

### 오후 7:15 - 실적 기반 미래 계획 자동 연동 및 수량 소수점 대응
- **초과 생산 시 미래 일정 자동 차감 로직 고도화**:
    - **중복 차감 버그 수정**: 동일 일정에 실적을 여러 번 나누어 입력할 때 미래 계획이 중복으로 깎이던 문제를 해결하고, 새롭게 발생한 초과분(`delta_excess`)만 차감하도록 수정.
    - **시간순 필터링 적용**: 현재 작업보다 나중에 시작하는(`start_time` 기준) 미래의 `pending` 일정만 차감 대상으로 제한하여 데이터 무결성 강화.
- **수량 데이터 타입 전면 전환 (int -> float)**:
    - **소수점 수량 지원**: 주문의 목표 수량, 초기 재고, 일일 생산 계획, 실적 입력 등 모든 수량 관련 필드에서 소수점 입력을 지원하도록 백엔드(`app.py`)와 프론트엔드(`main.js`) 로직을 `float` 기반으로 전면 수정.
    - **정밀 통계 반영**: 대시보드 진행률 및 재고 소모량 계산 시 소수점 단위가 누락되지 않도록 `parseFloat` 및 `float()` 처리 적용.

### 오후 1:15 - 프린터 자산 관리 및 입력 편의 기능 추가
- **프린터 자산 관리 기능 구현**:
    - 프린터 추가/삭제 기능.
    - 구입일(Purchase Date) 기록 및 현재 날짜 기준 경과일(D+일) 자동 계산 표시.
    - 수리일 기록을 위한 데이터 구조(Schema) 확장.
- **출력 대상명 자동완성(Datalist) 도입**:
    - 기존에 입력했던 출력물 이름을 최신순으로 드롭다운 목록에 표시.
    - 중복 제거 및 최신 데이터 우선 로직 적용.
- **API 엔드포인트 확장**:
    - `/api/v1/printers` (POST, DELETE)
    - `/api/v1/tasks/history` (GET)

### 오후 1:05 - AI 친화적 타임라인(간트) 뷰 구현
- **시각화 레이아웃 추가**:
    - HTML `<table>`과 CSS Grid를 활용한 타임라인 뷰 구현.
    - 에이전트가 데이터 구조를 즉시 파악할 수 있는 시맨틱 마크업 준수.
- **상태 연동**: 타임라인 상에서 출력 성공/불량 여부를 색상으로 구분.

### 오후 12:55 - 데이터 입력 및 상태 관리 기초 구현
- **입력 폼 추가**: 출력 예약 및 필라멘트 재고 등록 기능.
- **상태 업데이트**: 출력물별 [성공]/[불량] 버튼을 통한 실시간 상태 반영.
- **대시보드 통계**: 총 작업 수, 불량 합계 등을 실시간 계산하여 표시.

### 오전 11:30 - 프로젝트 초기화 및 설계
- **기본 폴더 구조 생성**: `00_Management` 템플릿 기반 구조 확립.
- **기술 스택 확정**: Python Flask (Backend) + JSON (DB) + Vanilla JS (Frontend).
- **요구사항 분석**: 3D 출력물 일정 및 수량 관리를 위한 설문 진행 및 데이터 스키마 정의.
- **AI 친화적 설계 원칙 수립**: Pure HTML 기반의 시맨틱 태그 및 REST API 중심 통신.

### 오후 1:25 - 데이터 저장 안정화 및 백엔드 로직 보강
- **절대 경로 기반 DB 접근**: 서버 실행 위치에 상관없이 `db.json`을 정확히 찾아 읽고 쓰도록 수정.
- **데이터 무결성 보장**: 
    - 일정 등록 시 필수 필드(ID, 상태, 생성일자) 자동 생성 로직 추가.
    - JSON 파싱 에러 발생 시 초기 데이터로 복구하는 예외 처리 추가.
- **Frontend 비동기 처리 개선**: 
    - `postData` 이후 서버 응답을 `await`로 확인하고 `fetchData`를 호출하여 화면 갱신 동기화.
    - 데이터가 없을 때의 UI 처리(테이블 내 안내 문구) 추가.
- **날짜 계산 로직 정밀화**: 구입일 기준 경과일 계산 시 시간 단위를 제외한 날짜 중심 계산 적용.

### 오후 6:25 - 필라멘트 컬러 배지(Visual Color Badge) 도입
- **시각적 가시성 강화**:
    - 재고 목록의 색상(Color) 텍스트를 실제 색상 배경의 배지로 변경.
    - 한국어 색상명(백색, 검정, 녹색, 노랑 등) 및 영문 색상명 자동 매핑 지원.
- **가독성 자동 최적화 로직**:
    - 배경색의 밝기(Luminosity)를 계산하여, 밝은 배경에는 검정 글씨, 어두운 배경에는 흰색 글씨가 자동으로 적용되도록 구현.
    - 텍스트 가독성을 보장하면서도 직관적인 재고 파악 가능.

### 오후 6:15 - 재고 목록 자동 정렬(Natural Sort) 기능 추가
- **가독성 개선**: 
    - 필라멘트 재고 목록 렌더링 시 재질(Material) 및 색상(Color) 이름순으로 자동 정렬되도록 로직 추가.
    - `localeCompare`의 숫자 정렬 모드를 활성화하여 "pla1", "pla2", "pla10" 등이 숫자 크기 순서대로 정렬되도록 구현.
- **편의성**: 사용자가 이름을 변경하더라도 리스트가 항상 정렬된 상태를 유지하여 특정 항목을 찾기 쉬워짐.

### 오후 6:00 - 시간 기반 정밀 재고 차감 로직 업그레이드
- **이중 차감 방지 로직 도입**:
    - 재고 입력(저울 측정값 입력) 시점과 생산 실적 입력 시점이 겹칠 때 발생하는 데이터 오류를 방지하기 위해 **시간 비교 로직** 추가.
    - 각 필라멘트 재고의 `updated_at`(기록 시간) 이후에 생성된 생산 실적(`created_at`)만 소모량으로 계산.
- **기대 효과**: 
    - 사용자가 저울로 재고를 실측하여 업데이트하는 순간, 시스템은 그 이전의 모든 소모 기록을 무시하고 새 측정값을 기준으로 다시 소모량을 추적함.
    - "생산 전 무게"든 "생산 후 무게"든 관계없이 입력한 시점만 명확하면 항상 정확한 추정 잔량 유지 가능.

### 오후 5:40 - 감사 로그(Audit Log) 시스템 도입
- **데이터 변경 이력 로깅**:
    - 모든 생성(CREATE), 수정(UPDATE), 삭제(DELETE) 요청 발생 시 `data/user_actions.log` 파일에 즉시 기록.
    - 기록 항목: 작업 시간, 요청자 IP 주소, 작업 유형, 대상 ID, 변경 상세 내용.
- **책임 소재 명확화**: 
    - 다수의 사용자가 이용할 경우, 누가 어떤 데이터(주문, 일정, 재고, 프린터)를 언제 변경했는지 추적할 수 있는 기반 마련.

### 오후 5:25 - 재고 및 프린터 수정 기능 복구 및 타임라인 뷰 보강
- **버그 수정**: 
    - 필라멘트 재고 및 프린터 자산 리스트의 '수정' 버튼 클릭 시 팝업이 뜨지 않던 문제 해결.
    - 비어있던 `openInventoryEdit`, `openPrinterEdit` 등 관련 JavaScript 함수들을 실제 데이터 바인딩 로직과 함께 구현.
- **타임라인(간트) 뷰 구현**:
    - 비어있던 `renderTimeline` 함수를 구현하여 향후 7일간의 프린터별 가동 일정을 시각적으로 확인할 수 있도록 보강.
    - 작업 상태(완료/대기)에 따라 색상 구분 반영.

### 오후 5:10 - 필라멘트 재고 기록 시간(Timestamp) 관리 기능 추가
- **정밀한 시간 추적 도입**: 
    - 재고를 새로 등록하거나 잔량을 수정할 때마다 **날짜와 시간(`YYYY-MM-DD HH:mm:ss`)을 자동으로 기록**.
    - 이를 통해 해당 무게 데이터가 생산 전, 생산 중, 혹은 생산 후에 측정된 것인지 명확히 파악 가능.
- **백엔드/프런트엔드 연동**:
    - `db.json` 내 `inventory` 객체에 `updated_at` 필드 추가.
    - 재고 관리 테이블에 **'기록 시간'** 컬럼을 신설하여 최신 업데이트 시점을 상시 노출.

### 오후 4:55 - 생산 실적 기반 실시간 필라멘트 소모 로직 반영
- **추정 잔량(Estimated Stock) 계산 도입**:
    - 단순히 `재고 - 미래 필요량`을 비교하던 방식에서, **`등록 재고 - 현재까지의 소모량(실적 기반)`**을 통해 현재 스풀에 남아있을 실제 양을 먼저 추정하도록 개선.
    - 소모량 계산식: `해당 재질/색상을 사용하는 모든 주문의 생산 실적 합계 * 개당 무게`.
- **판단 기준 고도화**:
    - `추정 잔량` vs `향후 필요량(잔여 수량 * 개당 무게)`을 비교하여 수급 상태를 판정.
- **UI 정보 구체화**:
    - 재고 목록에 '등록 무게'와 별개로 시스템이 계산한 **'추정 잔량'**을 명시하여 사용자가 실제 스풀 무게와 비교해볼 수 있도록 지원.

### 오후 4:40 - 필라멘트 수급 현황 가시성 개선
- **종류별 통합 수급 판정 로직 도입**:
    - 개별 필라멘트 스풀 단위로 필요량을 표시하던 방식에서, **재질/색상별 전체 재고와 전체 필요량을 합산 비교**하는 방식으로 개선.
    - 동일한 PLA 블랙 필라멘트가 여러 개 있어도, 전체 합계가 필요량보다 많으면 **'재고 충분'** 상태로 표시되어 사용자 혼동 방지.
- **상태 메시지 구체화**:
    - **재고 충분**: 초록색 텍스트로 여유 수량(Total Stock - Total Need)을 함께 표시.
    - **재고 부족**: 빨간색 텍스트로 실제 부족분(Total Need - Total Stock)만 표시하고 행 전체를 주황색으로 강조.
- **UI 최적화**: 천 단위 구분 쉼표(toLocaleString) 적용 및 불필요한 중복 텍스트 제거.

### 오후 4:20 - 실적 입력 로직 고도화 및 UI 용어 수정
- **실적 누적(+) 시스템 도입**: 
    - 한 일정에 대해 여러 번 실적을 입력해도 기존 값에 더해지도록 수정 (예: 10개 입력 후 다시 5개 입력 시 총 15개로 기록).
- **계획 초과분 자동 처리**: 
    - 특정 날짜에 계획보다 많이 생산할 경우, 동일 주문의 **미래 일정(Pending)에서 초과분만큼 계획 수량을 자동 차감**.
    - 이를 통해 전체 생산 일정이 실질적으로 앞당겨지는 효과 반영.
- **UI 용어 직관화**:
    - 주문 카드 내 '추가 필요량' 문구를 **'필요 필라멘트'**로 변경하여 용도 명확화.
    - 실적 입력 프롬프트에 '(누적됨)' 안내 추가.

### 오후 3:30 - 프린터 가용 일정 시각화 (Flatpickr 도입)
- **달력 UI 고도화**:
    - Flatpickr 라이브러리를 도입하여 HTML 기본 날짜 입력기의 시각적 한계 극복.
- **가용성 시각화 로직**:
    - 프린터 선택 시, 해당 장비의 기존 일정(Busy Dates)을 서버에서 조회.
    - 달력 팝업 내에서 **예약된 날짜는 회색으로 비활성화** 처리하여 중복 선택 원천 차단.
    - **선택 가능 날짜는 녹색** 톤으로 스타일링하여 가용성 직관적 파악 가능.
- **모드별 UI 최적화**:
    - 자동 계획 모드: 날짜 선택만 가능 (`YYYY-MM-DD`).
    - 수동 할당 모드: 시간까지 선택 가능 (`YYYY-MM-DD HH:mm`).

### 오후 3:15 - 생산 일정 리스트 가독성 및 정렬 개선
- **날짜 중심 정렬**: 모든 생산 계획을 날짜순(오름차순)으로 자동 정렬하여 공정 흐름 가시성 확보.
- **생산품별 시각적 분리**: 
    - 리스트 출력 중 생산품(주문)이 변경될 때마다 회색 구분 행(`product-separator`)을 삽입하여 그룹화.
- **2줄 레이아웃 적용**:
    - 한 행 내에서 제품명/재질, 계획/실적 수량 등을 2줄로 배치하여 정보를 더 여유롭게 표시.
- **컬럼 재배치**: 사용자 요청에 따라 날짜를 최우측에서 최좌측으로 이동 및 관리 버튼 배치 최적화.

### 오후 2:55 - 주문 등록 UI 개선 및 필라멘트 선택 자동화
- **입력 편의성 강화**: 
    - 주문 등록 시 '기존 재고 수량' 칸에 placeholder 안내 문구 추가 및 기본값(`0`) 제거.
    - 재질 및 색상을 텍스트 입력 대신 **현재 보유 재고 목록**에서 선택할 수 있도록 드롭다운(Select) 방식으로 변경.
- **동적 데이터 바인딩**: 재고가 추가되거나 수정되면 주문 등록/수정 창의 필라멘트 목록도 실시간으로 동기화됨.

### 오후 2:45 - 필라멘트 소요량 예측 및 부족 경고 시스템
- **주문 상세 정보 확장**: 주문 등록 시 `재질(Material)`, `색상(Color)`, `개당 무게(Unit Weight)` 정보를 입력.
- **소요량 자동 계산**: 
    - `주문별 필요량` = (목표 수량 - 확보 수량) × 개당 무게.
    - 주문 카드에 '추가 필요 필라멘트 양' 표시.
- **재고 부족 경고**:
    - 동일한 재질/색상을 사용하는 모든 진행 중인 주문의 총 필요량을 합산.
    - 현재 보유 재고가 필요량보다 적을 경우, 재고 리스트에 **주황색 배경**과 함께 **부족 수량(필요량)**을 빨간색 텍스트로 표시.

### 오후 2:35 - 필라멘트 재고 및 프린터 자산 수정 기능 추가
- **관리 편의성 강화**: 등록된 필라멘트 재고 정보(재질, 색상, 무게)와 프린터 정보(모델, 식별번호, 구입일)를 언제든 수정할 수 있는 기능 추가.
- **삭제 기능 보강**: 불필요한 재고 항목을 삭제할 수 있는 API 및 UI 연동.
- **UI 일관성**: 주문 수정과 동일하게 오버레이 팝업 형태의 수정 인터페이스 적용.

### 오후 2:25 - 프린터 중복 할당 감지(Conflict Detection) 및 자산 ID 추가
- **프린터 식별 강화**: 기존 모델명 외에 고유 식별 번호(`asset_id`) 필드 추가 (예: P2SC-101).
- **중복 할당 경고 로직**:
    - 동일 프린터가 같은 날짜에 여러 개의 스케줄을 가질 경우, 시스템이 이를 감지하여 경고 발생.
    - 자동 계획 생성(`Auto-Schedule`) 시에도 중복 날짜를 감지하여 결과 메시지에 리포트.
- **UI 시각화**: 중복된 스케줄 행은 주황색 배경(`warning-color`)으로 표시되며, '[중복!]' 태그가 붙음.

### 오후 2:15 - 주문 수정(Order Edit) 기능 추가
- **주문 정보 업데이트**: 이미 등록된 주문의 제품명, 목표 수량, 기존 재고, 마감 기한을 수정할 수 있는 기능 추가.
- **상태 재계산 로직**: 목표 수량이나 기존 재고 수정 시, 현재까지의 생산 실적과 비교하여 주문 상태(진행중/완료)를 자동으로 재설정.
- **UI 구현**: 각 주문 카드에 '수정' 버튼 추가 및 오버레이 형태의 수정 폼 구현.

### 오후 2:05 - 주문별 기존 재고(Initial Stock) 반영 기능 추가
- **기존 재고 관리**: 주문 등록 시 '기존 재고 수량'을 입력할 수 있도록 필드 추가.
- **계산 수식 고도화**:
    - **잔여 생산 필요량** = 목표 수량 - 기존 재고 - 누적 생산 실적.
    - **전체 확보량** = 기존 재고 + 생산 실적.
- **자동 스케줄링 연동**: 자동 계획 생성 시, 목표 수량에서 기존 재고를 제외한 '진짜 필요한 생산량'만큼만 일정을 생성하도록 API 로직 수정.
- **UI 업데이트**: 주문 카드에 (재고 + 생산) 합산 정보를 상세히 표시하여 직관적인 현황 파악 가능.

### 오후 1:55 - 생산 계획 자동 생성(Auto-Scheduling) 기능 추가
- **기능 개요**: 시작일과 일일 목표 생산량(Capa)을 입력하면, 주문의 잔여 수량을 채울 때까지의 일별 생산 계획을 자동으로 계산하여 일괄 생성.
- **백엔드 로직**: 
    - `/api/v1/schedules/auto` 엔드포인트 신설.
    - 잔여 수량(`remaining_qty`)이 0이 될 때까지 루프를 돌며 일별 계획 생성.
    - 마지막 날짜는 남은 수량만큼만 할당.
- **UI/UX**: 
    - [자동 계획 생성 모드] 체크박스를 통해 단일 등록/일괄 등록 UI 전환.
    - 완료 후 생성된 계획 개수 알림 팝업 제공.

### 오후 1:45 - 생산 계획 삭제 기능 추가
- **삭제 버튼 및 확인 팝업**: 생산 일정 리스트에 [삭제] 버튼 추가 및 삭제 시 확인 팝업(`confirm`) 연동.
- **실적 연동 삭제**: 특정 일정을 삭제하면 해당 일정이 기여했던 주문의 '누적 완료 수량'이 자동으로 차감되어 계산되도록 백엔드 로직 보강.

### 오후 1:35 - 생산 관리 시스템 (MES Lite) 구조 개편
- **주문(Order) 중심 아키텍처 도입**:
    - 전체 생산 목표를 정의하는 '주문'과 실행 단위인 '일정'으로 계층화.
    - 주문 카드 UI: 목표, 완료, 잔여 수량 및 진행률 바 시각화.
- **실적 기반 자동 계산**:
    - 일일 생산 실적 입력 시 주문의 잔여 수량이 자동으로 차감되는 수식 적용.
- **데이터 마이그레이션**: 기존 `schedules` 구조에 `order_id`와 `actual_quantity` 필드 추가.

### 오후 7:15 - 실적 기반 미래 계획 자동 연동 및 수량 소수점 대응
- **초과 생산 시 미래 일정 자동 차감 로직 고도화**:
    - **중복 차감 버그 수정**: 동일 일정에 실적을 여러 번 나누어 입력할 때 미래 계획이 중복으로 깎이던 문제를 해결하고, 새롭게 발생한 초과분(`delta_excess`)만 차감하도록 수정.
    - **시간순 필터링 적용**: 현재 작업보다 나중에 시작하는(`start_time` 기준) 미래의 `pending` 일정만 차감 대상으로 제한하여 데이터 무결성 강화.
- **수량 데이터 타입 전면 전환 (int -> float)**: 주문의 목표 수량, 초기 재고, 일일 생산 계획, 실적 입력 등 모든 수량 관련 필드에서 소수점 입력을 지원하도록 백엔드(`app.py`)와 프론트엔드(`main.js`) 로직을 `float` 기반으로 전면 수정.

### 오후 7:45 - 주문 완료 시 재고 실측치 정밀 피드백 기능
- **다중 재고 실측 업데이트**: 주문 완료(목표 수량 달성) 시, 해당 제품에 사용된 필라멘트(재질/색상 기반)들을 자동 검색하여 각각의 실제 측정 무게를 순차적으로 입력받는 팝업 로직 구현.
- **유연한 재고 검색(Flexible Matching)**: 재질명이 완벽히 일치하지 않더라도(예: PLA vs PLA1) 서로를 포함하는 경우 관련 재고로 인식하여 사용자에게 선택지를 제공하도록 개선.

### 오후 8:10 - 스마트 주문 등록 및 소모량 가시성 개선
- **입력 편의성 강화**:
    - **재질/색상 병기 및 자동 연동**: 주문 등록 시 재질 선택 창에서 색상 정보를 함께 표시하고, 선택 시 해당 필라멘트의 색상 자동 선택 및 현재 시스템상 잔량 안내 팝업 제공.
    - **기존 무게 추천**: 제품명 입력 시 과거 생산 기록을 조회하여 "기존 무게(g) 재사용 여부"를 묻는 스마트 추천 기능 도입.
- **소모량 표시 고도화**: 주문 카드에 '전체 소모(예정)량'을 상시 표시하여, 생산 완료 후에도 총 필라멘트 사용량을 확인할 수 있도록 수정.

### 오후 8:30 - 데이터 연동 삭제 및 퀵 등록 시스템 도입
- **연동 삭제(Cascade Delete) 옵션**: 주문 삭제 시 "연동된 생산 계획(일정)도 함께 삭제할지"를 선택할 수 있는 2차 확인 팝업 추가.
- **최근 생산 품목 퀵 필(Quick Fill)**: 주문 등록 폼 하단에 최근 생산한 상위 5개 품목 리스트를 버튼 형태로 제공. 클릭 시 제품명과 개당 무게가 즉시 자동 입력됨.
- **데이터 예외 처리 강화**: 연동된 주문이 삭제된 생산 일정의 경우 UI에서 `Unknown` 대신 `삭제된 주문`으로 명확히 표시되도록 렌더링 로직 보강.

### 오후 9:15 - 배치(Batch) 시스템 도입 및 강력한 재고 통합 로직 구현
- **배치(Batch) 식별자 추가**: 
    - 필라멘트 재고 관리 시 `A1`, `A2`, `A3`, `A4` 중 하나를 지정할 수 있는 배치 필드 신설.
    - 동일한 재질이라도 배치별로 구분하여 관리하되, 계산 시에는 지능적으로 통합하도록 설계.
- **전체 배치 통합 산출(Batch Aggregation)**:
    - **산수 로직 전면 개편**: 기존에 개별적으로 계산되던 재고 필요량을 재질/색상이 같은 모든 배치를 합산하여 계산하도록 수정. (예: A1+A2+A3 전체 잔량 vs 전체 필요량 비교)
    - **시각적 합산 내역 표시**: 재고 리스트 상에 `[부족] 통합(A1+A2+A3): 900g / 필요: 1848g`과 같이 어떤 배치들이 합쳐져 계산되었는지 투명하게 노출.
- **지능형 재질 매칭**: 대소문자 무시, 숫자 제거(PLA1, PLA2 -> PLA), 부분 일치 검색 등을 통해 사용자가 이름을 조금씩 다르게 입력해도 같은 계열의 재질로 인식하여 합산되도록 보강.

### 오후 9:35 - 시스템 안정성 강화 및 사용자 피드백 반영
- **배치 중복 등록 경고**: 이미 존재하는 배치 이름을 새 재고에 할당하려 할 때, "이미 등록된 배치"임을 알리고 계속 진행할지 여부를 묻는 확인 팝업창 구현.
- **UI 렌더링 버그 수정**: 자바스크립트 중복 코드 및 문법 오류로 인해 데이터베이스 연결이 끊겨 보이던(데이터 미표시) 현상을 해결하고 렌더링 엔진 안정화.
- **소수점 정밀도 통일**: 모든 무게 및 수량 표시를 `toFixed(1)`로 통일하여 UI상에서의 수치 가독성 및 정밀도 확보.

## [2026-02-12] - 버전 03 고도화
### 오후 10:15 - 사진 업로드 및 시각적 관리 기능 추가
- **주문별 제품 사진 관리**: 각 주문 카드에 사진 업로드 기능을 추가하여 출력 대상물을 시각적으로 즉시 파악할 수 있도록 구현.
- **이미지 자동 저장**: 서버 내 `static/uploads` 폴더에 이미지를 저장하고 `db.json`에 경로를 연동.
- **UI 개선**: 사진이 없을 경우 '사진 추가' 플레이스홀더를 표시하고, 클릭 시 파일 선택창이 뜨도록 UX 설계.

### 오후 10:30 - 상세 통계 리포트 (Statistics) 섹션 구현
- **재질별 총 소모량 집계**: 모든 생산 실적을 분석하여 재질/색상별로 총 몇 그램(g)의 필라멘트가 사용되었는지 자동으로 계산 및 표시.
- **프린터별 가동률 분석**: 각 프린터가 수행한 총 작업 건수와 생산한 제품의 총 수량을 랭킹 순으로 제공.
- **생산 랭킹 (Top 5)**: 가장 많이 생산된 제품 5가지를 대시보드 스타일의 카드로 시각화.

### 오후 10:45 - 프린터 유지보수(Maintenance) 관리 기능 도입
- **점검 기록 시스템**: 각 프린터별로 유지보수 내역(노즐 교체, 베드 레벨링 등)을 날짜와 함께 기록할 수 있는 기능 추가.
- **최근 점검일 노출**: 프린터 자산 목록에서 각 장비의 '최근 점검일'을 즉시 확인할 수 있도록 UI 보강.
- **API 확장**: `/api/v1/printers/<id>/maintenance` 엔드포인트를 통한 체계적인 이력 관리.

### 오후 11:10 - 공장 초기화(Factory Reset) 및 안전 장치 구현
- **시스템 전체 초기화**: 모든 데이터(주문, 일정, 재고, 프린터)를 삭제하고 초기 상태로 되돌리는 기능 추가.
- **보안 텍스트 확인**: 실수 방지를 위해 `idodelete`라는 특정 문구를 직접 입력해야만 초기화가 진행되도록 2중 안전 장치 적용.
- **UI 시각화**: 헤더에 빨간색 강조 버튼 배치 및 경고 알림창 연동.

### 오후 11:25 - 주문 관리 내 배치(Batch) 식별 기능 강화
- **재질 선택 시 배치 병기**: 주문 등록/수정 시 드롭다운 목록에서 `[A1] PLA (Black)`와 같이 배치 정보를 함께 표시하여 사용 필라멘트 식별 명확화.
- **주문 카드 배지 표시**: 각 주문 카드에 현재 사용 중인 필라멘트의 배치를 시각적 배지로 표시.
- **데이터 스키마 확장**: 주문(Order) 데이터 구조에 `batch` 필드 추가 및 백엔드 연동.

### 오후 11:40 - 통계 리포트 접이식(Collapsible) UI 및 상태 가시성 개선
- **공간 최적화**: 통계 리포트 섹션을 기본적으로 접어두어 메인 화면의 복잡도를 낮추고, 필요 시에만 펼쳐볼 수 있도록 개선.
- **상태 연동 텍스트 및 아이콘**:
    - 접힘 상태: "클릭하여 **펼치기** / 접기 ▼" (펼치기 단어 강조 및 아래 화살표)
    - 펼침 상태: "클릭하여 펼치기 / **접기** ▲" (접기 단어 강조 및 위 화살표)
- **가독성 유지**: 펼친 후에도 안내 문구가 사라지지 않도록 CSS 로직 보강 및 다크모드 강조 색상 대응.

### 오후 11:50 - 감사 로그(Audit Log) 기록 범위 확대
- **상세 로깅**: 주문 생성 시 재질/색상/배치 정보 포함, 사진 업로드, 유지보수 기록, 공장 초기화 등 버전 03의 모든 신규 작업을 `user_actions.log`에 기록하도록 보강.

---
*Next Step: 클라우드 연동(Firebase 등) 또는 모바일 최적화 레이아웃 검토*

## [V04] 2026-02-12: 필라멘트 재고 로직 복원 및 버그 수정

### 1. 필라멘트 재고 산출 로직 복원 (Restore Filament Logic)
- **개별 주문 무게 반영**: 기존 대표 무게(Representative Weight) 방식에서 개별 주문(Order)의 `unit_weight_g`를 직접 참조하여 정밀 계산하도록 수정.
- **배치(Batch) 차감 로직 강화**: 주문에 배치가 지정된 경우, 해당 배치의 재고에서만 차감되도록 로직 개선.
- **상태 텍스트 복원**: 재고 목록에서 [충분/부족] 상태 및 파란색 실측 후 소모량 텍스트가 정상 표시되도록 복원.

### 2. 주문 수정 버그 수정 (Fix Order Edit Bug)
- **증상**: 주문 수정(Edit) 시 재고 ID가 재질명(Material Name)으로 잘못 저장되어, 재고 매칭이 끊기는 현상 발생.
- **조치**: `main.js`의 수정 폼 제출 핸들러를 개선하여 재질명과 배치를 올바르게 저장하도록 수정.
- **데이터 복구**: 기존 손상된 주문 데이터(Order ID `f2ce201e`, `667108ad`)를 스크립트로 자동 복구 완료.

### 3. 버전 04 생성
- `3Dprint_MEM_forLocal_03`의 모든 수정 사항을 반영하여 `3Dprint_MEM_forLocal_04`로 이관.
### 4. 코드 종합 점검 및 리팩토링 (Comprehensive Code Review & Refactoring)
- **main.js 최적화**: `renderInventory` 함수 내에서 중복 사용되던 '소모량 계산 로직'을 별도 헬퍼 함수(`calculateConsumedWeight`)로 분리하여 유지보수성 및 코드 가독성 향상.
- **개발자 의도(Intent) 검증**: `progressLog` 및 `task.md`에 기술된 모든 주요 기능(배치 관리, 상태 텍스트, 주문 수정 등)이 정상 작동함을 확인.
- **불필요 코드 정리**: `app.py` 및 `main.js` 내 미사용 변수 및 디버깅 로그 점검 완료 (특이사항 없음).

## [V05] 2026-02-13: 불량 관리 시스템 및 과거 날짜 수정 기능 추가

### 1. 생산 일정 과거 날짜 선택 해제 (Unlock Past Dates)
- **자유로운 일정 조정**: `flatpickr`의 `minDate: "today"` 제한을 제거하여, 과거(12일 등)에 걸쳐 진행된 작업이나 누락된 실적을 소급 입력할 수 있도록 개선.
- **유연성 확보**: 며칠에 걸친 장기 출력물이나 사후 데이터 수정을 완벽히 지원.

### 2. 불량 관리(Defect Management) 시스템 도입
- **불량 입력 기능**: 생산 일정 리스트에 [불량입력] 버튼 신설.
- **데이터 축적**: 불량 수량뿐만 아니라 '불량 사유'를 함께 입력받아 `defect_reasons` 리스트로 누적 관리.
- **수식 연동 (무게 계산)**: 시스템 추정 잔량 계산 시 `성공 실적 + 불량 실적`을 모두 합산하여 필라멘트 소모량에 반영하도록 로직 고도화.
- **주문 상태 보호**: 불량 수량은 주문의 `completed_quantity`에는 합산되지 않아, 실제 양품 데이터만 목표 수량에 반영됨을 보장.

### 3. UI/UX 개선
- **실적/불량 버튼 배치**: 관리 컬럼 내 버튼들을 가변 레이아웃(`flex-wrap`)으로 배치하여 좁은 화면에서도 깨지지 않도록 최적화.
- **시각적 가시성**: 불량이 발생한 일정에는 빨간색으로 `불량: N개` 표시를 추가하여 즉각적인 파악 지원.
- **입력 유효성 강화**: 실적/불량 입력 시 빈 값이나 숫자가 아닌 입력에 대한 예외 처리 강화.

### 4. 필라멘트 재고 차감 로직 정밀화 (Inventory Logic Correction)
- **차감 기준 변경**: 소모량 계산 시 데이터 입력 시간(`created_at`)이 아닌 실제 생산일(`start_time`)을 기준으로 필터링하도록 수정.
- **버그 해결**: 과거 데이터를 뒤늦게 입력하더라도, 재고 실측 시점보다 이전 날짜의 작업이라면 중복 차감되지 않도록 로직 안정화. (음수 재고 발생 문제 해결)

### 5. 불량 사유 툴팁(Tooltip) UI 구현
- **직관적 정보 제공**: '불량: N개' 텍스트 위에 마우스를 올리면 그동안 입력된 모든 불량 사유가 나타나는 커스텀 툴팁 기능 추가.
- **고급 디자인**: 어두운 테마의 팝업 배경과 부드러운 페이드인 애니메이션을 적용하여 전문가용 MES 느낌 부여.
- **누적 사유 확인**: 사유가 여러 개일 경우 줄바꿈을 통해 리스트 형태로 한눈에 파악 가능.

### 6. 필라멘트 재고 실측 데이터 반영 (Manual Inventory Adjustment)
- **실측치 업데이트**: 사용자 지시에 따라 13일 오전 기준 실측된 재고량을 DB에 직접 반영. (A1: 300g, A2: 350g, A3: 300g, A4: 700g)
- **기준 시간 설정**: 재고 실측 시점을 2026-02-13 09:00:00으로 설정하여, 이후의 생산 실적이 정확히 차감되도록 정렬 완료.

### 7. 불량 회복 알림 모니터링 시스템 구현
- **지능형 부족분 계산**: `목표 - (기존재고 + 실성공 + 미래계획)` 수식을 기반으로, 불량이 발생한 주문에 대하여 실제로 더 뽑아야 할 수량을 자동 계산함.
- **시각적 알림**: 부족분이 발생하면 생산 계획 섹션 상단에 복구 권장 알림(주황색)을 게시하여 누락 방지.
- **일정 복구 단축키**: [복구 일정 추가] 버튼 클릭 시, 해당 주문과 부족 수량이 입력폼에 자동 완성되도록 구현.

### 8. 불량 수량의 마이너스(-) 입력 통한 실적 복구 로직 구현
- **기능 개선**: 불량 입력창에 마이너스 수량(예: -4)을 입력하면, 이를 '실무자의 판단하에 양품으로 전환'한 것으로 간주하여 **성공 실적(Actual Quantity)으로 자동 합산**되도록 백엔드(pp.py) 로직 수정.
- **데이터 정정**: 'LED 커버' 주문에서 최종 허가자의 승인에 따라 살려낸 4개를 성공 수량에 즉시 반영 완료. (24개 -> 43개로 정정, 불량 6개는 그대로 유지하되 사유에 복구 내역 기록)
- **보안성 유지**: 단순 수량 정정이 아니라 '불량 사유' 히스토리에 누가 왜 복구했는지 기록(-4.0개: 최종허가자의 허가하에 4개 살림)이 남도록 설계하여 데이터 투명성 확보.
