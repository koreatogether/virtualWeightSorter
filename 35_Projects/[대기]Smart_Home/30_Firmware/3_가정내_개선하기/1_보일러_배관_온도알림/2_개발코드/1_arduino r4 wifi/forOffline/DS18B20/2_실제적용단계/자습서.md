# 아두이노 코드 리팩토링 자습서

이 자습서는 rev2와 rev3 코드의 차이를 통해 아두이노 환경에서 코드 리팩토링 및 정리 방법을 배우기 위한 자습서입니다. 아래에 rev2 코드에서 rev3 코드로 개선된 주요 포인트와 이를 위해 공부해야 할 주제들을 정리하였습니다.

## 1. 서론

초기 rev2 코드는 기능별로 동작은 하였으나 반복되는 코드와 중복된 로직, 그리고 모듈화가 미흡한 부분이 있었습니다. rev3 코드는 이러한 문제를 개선하여 가독성과 유지보수성을 높였습니다.

## 2. 주요 개선점

- **구조화 및 모듈화**
  - 기능별로 초기화, 데이터 읽기, 정렬, 출력 등 역할을 분리하여 함수로 구현
  - LCD 초기화 및 센서 초기화, 정렬 작업을 별도의 함수로 분리

- **코드 가독성 향상**
  - 변수 및 함수 이름을 직관적으로 변경하여 코드의 의도를 명확하게 표현
  - 주석을 활용하여 각 단계의 역할과 동작을 설명

- **타이머와 비차단(delay 없는) 방식 사용**
  - LCD 상태 관리와 시리얼 출력에 타이머를 활용하여 비차단식으로 구현

- **에러 처리 및 디버깅 강화**
  - 센서의 주소, ID 읽기 실패 시 에러 메시지 출력 및 경고
  - 각 단계별 진행 상황을 LCD와 시리얼 모니터에 명확히 표시

## 3. 공부해야 할 주제들

### 3.1 함수 및 모듈화

- 함수 추출과 역할 분리: 각각의 기능(초기화, 데이터 읽기, 정렬 등)을 독립된 함수로 분리하여 코드 재사용성 및 유지보수성 향상
- 모듈화 기법: 큰 프로그램을 여러 개의 모듈로 나누어 관리하는 방법

### 3.2 상태 관리와 비차단 방식 프로그래밍

- 타이머 활용: millis() 함수를 통한 타이밍 관리와 이벤트 기반 프로그래밍
- 비차단 처리: delay() 대신 타이머 기반의 코드 흐름 제어

### 3.3 에러 처리 및 디버깅 기법

- 에러 메시지 출력: 센서 오류나 통신 오류시 적절한 에러 메시지 출력을 통한 디버깅
- 단계별 상태 표시: LCD와 시리얼 모니터를 통한 현재 실행 단계 확인

### 3.4 코드 가독성 개선

- 변수, 함수, 주석 작성 규칙: 명확한 이름 짓기, 주석 달기, 코드 포매팅을 통한 가독성 향상
- 리팩토링 도구와 테크닉: 기존 코드를 분석하고, 중복 제거 및 구조 개선하는 기법들

## 4. 적용 방법

1. **Rev2 코드 분석**: 기존 rev2 코드를 읽고, 반복되는 부분이나 중복된 로직을 찾는다.
2. **기능 분리**: 각각의 기능(센서 초기화, LCD 업데이트, 시리얼 출력 등)을 별도의 함수로 분리한다.
3. **타이머 기반 제어 적용**: delay() 사용을 최소화하고, millis() 기반으로 타이머 로직을 구현한다.
4. **에러 처리 구현**: 센서 읽기 실패 및 통신 오류에 대한 처리 로직을 추가한다.
5. **리팩토링 및 코드 정리**: 코드 가독성을 높이기 위해 변수명, 함수명을 명확하게 하고, 주석을 추가하여 각 단계의 역할을 설명한다.
6. **테스트 및 검증**: 리팩토링 후 각 기능이 제대로 동작하는지 테스트한다.

## 5. 결론

Rev3 코드는 rev2에 비해 모듈화, 가독성, 유지보수성이 크게 향상되었습니다. 위에 열거한 주제들을 공부하고, 단계별로 적용해 나간다면 보다 효율적이고 안정적인 아두이노 코드를 작성할 수 있습니다.

Happy Coding!
