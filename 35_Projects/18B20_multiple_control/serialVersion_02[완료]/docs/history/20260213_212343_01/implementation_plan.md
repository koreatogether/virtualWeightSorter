# 아키텍처 개선 및 리팩토링 계획

`serialVersion_01`의 비평 내용을 바탕으로, 시스템의 안정성, 확장성 및 효율성을 극대화하기 위한 개선 계획을 수립합니다. 본 작업은 `serialVersion_02` 디렉토리에서 진행하여 기존 코드와 격리합니다.

## 목표
- **메모리 안정성**: 모든 `String` 및 동적 할당(`new`) 제거, `char` 배열 및 정적 할당 사용.
- **아키텍처 정규화**: `App` 클래스의 UI 로직을 분리하여 SRP(단일 책임 원칙) 준수.
- **반응성 개선**: 모든 차단형(Blocking) 호출 제거, 완전한 비차단 상태 머신 구현.
- **효율성**: 불필요한 추상화(`virtual`) 제거 및 VTable 오버헤드 최소화.

## 단계별 계획

### 1단계: 메모리 최적화 및 안정화
- [ ] `Communicator` 인터페이스에서 `String` 제거 및 `const char*`, `char` 버퍼 기반으로 변경.
- [ ] `main.cpp` 및 `App` 내의 `String` 기반 명령어 파싱 로직을 `strcmp` 및 `char` 배열 기반으로 교체.
- [ ] 동적 메모리 할당(`new`/`delete`)을 정적 배열 또는 풀(Pool)로 교체.

### 2단계: UI 핸들러 분리 (App 클래스 해체)
- [ ] [NEW] `SerialUI` 클래스 생성: 시리얼 메뉴 출력 및 텍스트 포맷팅 전담.
- [ ] `App` 클래스에서 메뉴 데이터(문자열 등)를 `SerialUI`로 이동.
- [ ] `App`은 오직 센서 데이터 흐름과 상태 전이만 관리하도록 축소.

### 3단계: 완전 비차단(Non-blocking) 시스템 전환
- [ ] `Communicator::readUserInput` 등 대기 로직 처리 방식 변경: `loop()`에서 즉시 반환하는 폴링 방식으로 전환.
- [ ] 상태 머신(`AppState`) 루프를 `millis()` 기반의 타이머와 인터럽트 친화적 구조로 개선.
- [ ] 텍스트 입력 시 `Serial.readStringUntil` 대신 문자 단위 수신 루프 구현.

### 4단계: 추상화 간소화 및 클린업
- [ ] 단일 구현체만 있는 클래스(`Communicator`, `DataProcessor` 등)의 `virtual` 키워드 제거.
- [ ] "For testing"으로 노출된 `public` 멤버 변수들을 `private`으로 캡슐화하고 필요한 접근자만 노출.
- [ ] `config.h`의 하드코딩된 상수들을 유연하게 관리할 수 있는 구조 검토.

---

## 검증 계획

### 자동화 테스트
- [ ] `pio run`: 정적 컴파일 성공 여부 및 메모리 사용량(RAM/Flash) 감소 확인.

### 수동 검증
- [ ] 시리얼 메뉴 응답성 테스트: 메뉴 전환 및 명령어 입력 시 지연 시간 확인.
- [ ] 장기 기동 테스트: 메모리 파편화로 인한 크래시 발생 여부 확인.

> [!IMPORTANT]
> 본 개선 사항은 `serialVersion_02` 폴더를 기반으로 진행하며, 기존 `serialVersion_01`은 레거시로 보존합니다.
