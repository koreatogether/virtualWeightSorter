# 12-로드셀 기반 3송이 최적 조합 로직 제안서

작성일: 2026-02-15
대상 프로젝트: `[대기]Weigher_Sorter`

## 1) 문제 정의
- 입력: 로드셀 12개에서 측정된 송이 무게 `w[0..11]`
- 제약: `정확히 3송이` 선택
- 목표: 박스 목표중량 `T`(예: 2000g)에 가장 가까운 조합 선택
- 허용오차: `±tol`(예: ±70g)

## 2) 추천 알고리즘
- 알고리즘명: `3개 고정 완전탐색 (Exact Search over C(12,3))`
- 조합 수: `C(12,3)=220`
- 선택 기준: `abs((wi + wj + wk) - T)` 최소

선정 이유:
- 문제 크기가 작아(220개) MCU에서도 실시간 처리 가능
- 그리디/랜덤 대비 정확도 최대, 에러율 최소
- 구현이 단순해 디버깅/검증이 쉬움

## 3) 선택 규칙(권장)
1. 12채널 중량 안정화 취득(필터 적용)
2. 220개 조합 모두 평가
3. 1차 기준: `오차 = abs(sum3 - T)` 최소
4. 2차 기준(동률):
   - 센서 신뢰도 높은 채널 조합 우선
   - 기구 배출 충돌 가능성이 낮은 조합 우선
5. 허용오차 내 조합이 있으면 그중 최적 선택, 없으면 최소오차 조합 선택
6. 선택된 3채널 배출 후 최종 박스 중량 재검증

## 4) 점수 함수(확장형)
기본형:
- `score = abs(sum3 - T)`

확장형(현장 안정화 권장):
- `score = abs(sum3 - T) + λ1*sensor_uncertainty + λ2*mechanical_risk`

권장 초기값:
- `λ1 = 0.3 ~ 1.0`
- `λ2 = 0.5 ~ 2.0`

## 5) 성능/정확도 관점
- 연산량: 220개 조합 합산 + 비교 연산
- 지연: Python/MCU 모두 실시간 요구 충족 가능 수준
- 정확도: 현재 제약(정확히 3송이)에서 사실상 최적해 보장

## 6) 에러율 저감 체크리스트
- 로드셀 노이즈 필터: 중앙값 + 이동평균
- 채널별 보정계수 적용(캘리브레이션)
- 드리프트 감시(주기적 영점 재설정)
- 배출 직후 최종 중량 재측정(pass/fail)
- fail 시 재시도 정책(재조합 또는 수동 분기)

## 7) 구현 의사코드
```python
best = None
best_err = float("inf")

for i in range(12):
    for j in range(i+1, 12):
        for k in range(j+1, 12):
            s = w[i] + w[j] + w[k]
            err = abs(s - T)
            if err < best_err:
                best_err = err
                best = (i, j, k, s)

# best: 선택된 3채널
```

## 8) 결론
- `12개 로드셀 + 정확히 3송이` 조건에서는 완전탐색이 정답에 가깝다.
- 빠르고, 정확하고, 에러율이 낮은 목표를 동시에 만족한다.
- 현장 품질은 알고리즘보다 `계측 안정화 + 재검증 루프`에서 크게 개선된다.
