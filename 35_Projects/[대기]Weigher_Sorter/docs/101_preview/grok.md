### 조합형 중량 선별기(Combination Weigher)의 개요

조합형 중량 선별기, 또는 멀티헤드 웨이어(Multihead Weigher)는 식품 산업, 특히 과일(포도송이, 배, 사과 등) 포장 시 사용되는 자동 계량 시스템입니다. 이 시스템은 여러 개의 계량 헤드(호퍼)를 활용해 제품을 분배하고, 각 헤드의 무게를 측정한 후 컴퓨터가 목표 무게에 가장 가까운 조합을 계산하여 선택적으로 배출합니다. 과일처럼 부드럽고 불규칙한 모양의 제품에 적합하며, 손 로딩(manual loading) 방식이나 벨트 컨베이어로 제품을 부드럽게 취급하는 모델이 많습니다. 예를 들어, 사과나 배 같은 과일은 12~16개의 헤드를 가진 시스템이 자주 사용되며, 스테인리스 스틸 구조와 터치스크린 인터페이스를 통해 위생과 정확성을 강조합니다.

이 시스템은 주로 포장 라인에 통합되어, 과일의 무게를 정확히 맞춰 봉지나 상자에 담아 생산성을 높입니다. 과일 전용 모델은 제품 손상을 최소화하기 위해 부드러운 피더(진동 대신 벨트나 손 공급)를 사용하며, IP65 등급의 방수 구조를 갖춘 경우가 많습니다.

#### 작동 원리(중심 설계)
조합형 중량 선별기의 핵심은 "조합 계산 알고리즘"입니다. 아래는 일반적인 작동 흐름입니다:

1. **제품 공급**: 중앙 분배 콘(dispersion cone)으로 과일(포도송이, 배, 사과 등)이 공급됩니다. 진동 피더나 벨트가 이를 각 헤드로 분배합니다.
2. **개별 계량**: 각 헤드(호퍼)에 제품이 들어가 무게를 측정합니다. 로드셀(load cell)이 무게를 감지합니다.
3. **조합 계산**: 컴퓨터가 모든 헤드의 무게를 기반으로 가능한 부분 집합(조합)을 계산합니다. 목표 무게(예: 500g)에 가장 가까운 합을 찾습니다. 이는 부분 집합 합 문제(subset sum problem)와 유사하며, 가까운 값 중 오버웨이트를 피하거나 최소 차이를 우선합니다.
4. **배출**: 선택된 헤드만 제품을 아래로 떨어뜨려 포장기로 보냅니다. 나머지 헤드는 다음 사이클을 위해 유지됩니다.
5. **반복**: 빈 헤드는 다시 채워지며, 연속적으로 작동합니다.

| 구성 요소               | 역할               | 과일 적용 예시                             |
| ----------------------- | ------------------ | ------------------------------------------ |
| 분배 콘                 | 제품을 균등 분배   | 포도송이처럼 클러스터 형태를 부드럽게 처리 |
| 피더(Feeder)            | 헤드로 제품 이동   | 벨트 타입으로 사과/배 손상 방지            |
| 웨이 호퍼(Weigh Hopper) | 무게 측정          | 10~16개 헤드, 각 50~150g 범위 과일 계량    |
| 제어 시스템             | 조합 알고리즘 실행 | 터치스크린으로 목표 무게 설정              |
| 배출 슈트(Chute)        | 선택 조합 배출     | 포장 라인 연결                             |

이 설계의 핵심은 효율적인 알고리즘으로, 작은 헤드 수(5~10개)에서도 2^n 조합을 빠르게 계산합니다. 실제 시스템은 고속 프로세서를 사용하지만, 개념적으로는 간단한 마이크로컨트롤러로 시뮬레이션 가능합니다.

### 아두이노로 간단한 개념 테스트 구현 아이디어
사용자가 지정한 대로, 실제 로드셀 등 하드웨어는 사용하지 않고 개념적 테스트 수준으로 아두이노를 활용합니다. 아두이노(예: Uno 또는 Nano)를 사용해 무게 값을 시뮬레이션(무작위 생성)하고, 조합 알고리즘을 실행하는 코드를 작성할 수 있습니다. 이는 시스템의 "중심 설계"인 조합 계산 부분을 표현합니다.

#### 기본 아이디어
- **시뮬레이션 설정**: 5~10개의 "헤드"를 배열로 표현. 각 헤드에 무작위 무게(예: 50~150g, 과일 한 개 무게 시뮬)를 할당.
- **알고리즘**: 모든 부분 집합을 검사해 목표 무게에 가장 가까운 조합 찾기. (작은 헤드 수로 계산 부하 최소화)
- **출력**: 시리얼 모니터로 무게 목록, 최적 조합, 합계 표시.
- **왜 아두이노?**: 간단한 C++ 코드로 실시간 계산 가능. 실제 시스템처럼 루프에서 반복 실행.
- **제한**: 아두이노 메모리 한계로 헤드 수를 10개 이하로 유지. (2^10 = 1024 조합, 처리 가능)

#### 아두이노 코드 스케치 예시
아래는 아두이노 IDE에서 사용할 수 있는 간단한 C++ 코드입니다. 실제 로드셀 대신 random() 함수로 무게 생성. 목표 무게는 500g으로 설정.

```cpp
#include <Arduino.h>

#define NUM_HEADS 8  // 헤드 수 (작게 유지)
#define TARGET_WEIGHT 500  // 목표 무게 (g)
#define MIN_WEIGHT 50  // 최소 과일 무게
#define MAX_WEIGHT 150  // 최대 과일 무게

int weights[NUM_HEADS];  // 각 헤드 무게 배열

void setup() {
  Serial.begin(9600);
  randomSeed(analogRead(0));  // 랜덤 시드
}

void loop() {
  // 무작위 무게 생성 (시뮬레이션)
  Serial.println("Generated weights:");
  for (int i = 0; i < NUM_HEADS; i++) {
    weights[i] = random(MIN_WEIGHT, MAX_WEIGHT + 1);
    Serial.print(weights[i]);
    Serial.print(" ");
  }
  Serial.println();

  // 최적 조합 찾기
  int best_sum = 0;
  int best_diff = INT_MAX;
  int best_mask = 0;  // 비트마스크로 조합 저장 (효율적)

  // 모든 부분 집합 검사 (1부터 2^NUM_HEADS - 1까지)
  for (int mask = 1; mask < (1 << NUM_HEADS); mask++) {
    int current_sum = 0;
    for (int i = 0; i < NUM_HEADS; i++) {
      if (mask & (1 << i)) {
        current_sum += weights[i];
      }
    }
    int diff = abs(current_sum - TARGET_WEIGHT);
    if (diff < best_diff || (diff == best_diff && current_sum > best_sum)) {  // 가까우면 선택, 동률 시 오버 우선 가능
      best_diff = diff;
      best_sum = current_sum;
      best_mask = mask;
    }
  }

  // 결과 출력
  Serial.print("Best combination (heads): ");
  for (int i = 0; i < NUM_HEADS; i++) {
    if (best_mask & (1 << i)) {
      Serial.print(i);
      Serial.print(" (");
      Serial.print(weights[i]);
      Serial.print("g) ");
    }
  }
  Serial.println();
  Serial.print("Sum: ");
  Serial.print(best_sum);
  Serial.print("g, Difference: ");
  Serial.println(best_diff);
  Serial.println("---");

  delay(5000);  // 5초 대기 후 반복 (실제 시스템처럼 사이클)
}
```

#### 코드 설명
- **무게 생성**: random()으로 각 헤드에 50~150g 할당. (포도송이/사과 한 개 무게 시뮬)
- **조합 계산**: 비트마스크로 모든 부분 집합(1개 이상) 검사. 목표와의 차이 최소화.
- **출력 예시**: 시리얼 모니터에서 "Generated weights: 142 137 119 ...", "Best combination: heads 0(142g) 1(137g) ...", "Sum: 500g, Difference: 0"처럼 표시.
- **테스트 방법**: 아두이노 보드에 업로드 후 시리얼 모니터 열기. 반복 실행으로 여러 사이클 시뮬.
- **개선 아이디어**: LED나 버튼으로 "배출" 시뮬 (e.g., 선택 헤드 LED 점등). 실제 과일 대신 숫자만으로 개념 증명.

이 코드는 시스템의 핵심 로직(조합 선택)을 아두이노로 간단히 구현한 것입니다. 실제 하드웨어 추가 시 로드셀 라이브러리(HX711 등) 연결 가능하지만, 요청대로 개념 수준으로 유지했습니다. 추가 질문 있으시면 말씀해주세요!