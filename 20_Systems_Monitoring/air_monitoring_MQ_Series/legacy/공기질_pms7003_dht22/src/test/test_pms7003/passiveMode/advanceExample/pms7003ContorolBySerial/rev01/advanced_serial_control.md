# Advanced PMS7003 Serial Control (Arduino R4 WiFi)

## ëª©ì 
- **Passive/Active Mode ì „í™˜ ê°€ëŠ¥**í•œ PMS7003 ì„¼ì„œë¥¼ Arduino R4 WiFi ë³´ë“œì—ì„œ ì œì–´
- 2ì´ˆ ê°„ê²©(Passive) ë˜ëŠ” ì•½ 1ì´ˆ ê°„ê²©(Active)ìœ¼ë¡œ ë°ì´í„°ë¥¼ ìˆ˜ì§‘í•˜ê³  **5ë¶„(150 ìƒ˜í”Œ)** ì •ë„ë¥¼ RAMì— ìˆœí™˜ ì €ì¥
- PCì™€ì˜ ì‹œë¦¬ì–¼(`Serial`, 115200 bps)ë¡œ **ë©”ë‰´ ê¸°ë°˜ ì¸í„°í˜ì´ìŠ¤**ë¥¼ í†µí•´ ëª…ë ¹ì„ ì£¼ê³  ê²°ê³¼ë¥¼ ì¶œë ¥

## í•˜ë“œì›¨ì–´ ì—°ê²°
| PMS7003 í•€ | Arduino R4 WiFi í•€ |
|------------|-------------------|
| VCC        | 5 V (ì „ì›)        |
| GND        | GND               |
| TX         | **Serial1 RX** (í•€ 0) |
| RX         | **Serial1 TX** (í•€ 1) â€“ ëª…ë ¹ ì „ì†¡ ì‹œë§Œ ì‚¬ìš© (ë ˆë²¨ ë³€í™˜ í•„ìš” ì‹œ ì €í•­ ë¶„ë°°) |

> **ì£¼ì˜**: ì„¼ì„œ ë¡œì§ ì „ì••ì€ 3.3 V. Arduino R4 WiFiëŠ” 5 V ë³´ë“œì´ë¯€ë¡œ `RX` â†’ ì„¼ì„œ `TX` ì—°ê²°ì€ ê·¸ëŒ€ë¡œ ì‚¬ìš©í•´ë„ ë¬´ë°©í•˜ì§€ë§Œ, `TX` â†’ ì„¼ì„œ `RX`ì€ ë ˆë²¨ ì‹œí”„í„°(ë˜ëŠ” ì €í•­ ë¶„ë°°) ê¶Œì¥.

## ì‚¬ìš© ë°©ë²•
1. ìŠ¤ì¼€ì¹˜ë¥¼ ë³´ë“œì— ì—…ë¡œë“œí•œë‹¤.
2. Arduino IDE í˜¹ì€ ì‹œë¦¬ì–¼ ëª¨ë‹ˆí„°ë¥¼ **115200 bps**ë¡œ ì—°ë‹¤.
3. ì´ˆê¸° í™”ë©´ì— **ë©”ë‰´**ê°€ í‘œì‹œë˜ë©°, ì•„ë˜ ìˆ«ì ëª…ë ¹ì„ ì…ë ¥í•˜ë©´ ë™ì‘í•œë‹¤.

### ğŸ“‹ ë©”ë‰´ ì˜µì…˜

| ëª…ë ¹ | ì„¤ëª… |
|------|------|
| `1` | ìµœì‹  **PM 1.0** ê°’ ì¶œë ¥ + í˜„ì¬ ëª¨ë“œ í‘œì‹œ |
| `2` | ìµœì‹  **PM 2.5** ê°’ ì¶œë ¥ + í˜„ì¬ ëª¨ë“œ í‘œì‹œ |
| `3` | ìµœì‹  **PM 10** ê°’ ì¶œë ¥ + í˜„ì¬ ëª¨ë“œ í‘œì‹œ |
| `4` | **ëª¨ë“  PM ê°’** (1.0, 2.5, 10) í•œ ì¤„ì— ì¶œë ¥ + í˜„ì¬ ëª¨ë“œ í‘œì‹œ |
| `5` | **ìµœê·¼ 20ì´ˆ ë°ì´í„° í…Œì´ë¸”** (ìµœê·¼ 10ê°œ ìƒ˜í”Œ) ì¶œë ¥ + í˜„ì¬ ëª¨ë“œ í‘œì‹œ |
| `6` | **ëª¨ë“œ ì „í™˜** (Active â†” Passive) |

### ğŸ”§ ì¶”ê°€ ëª…ë ¹ì–´ (ê³ ê¸‰ ì‚¬ìš©ììš©)

| ëª…ë ¹ | ì„¤ëª… |
|------|------|
| `GET TABLE` | 5ë¶„(150ê°œ) ì „ì²´ ë°ì´í„°ë¥¼ CSV í˜•íƒœë¡œ ì¶œë ¥ |
| `ANALYZE` | í˜„ì¬ 5ë¶„ í‰ê· ì„ ê³„ì‚°í•´ ìš”ì•½ ì¶œë ¥ |
| `RESET` | ì €ì¥ëœ ëª¨ë“  ë°ì´í„°ë¥¼ 0ìœ¼ë¡œ ì´ˆê¸°í™” |
| `MENU` ë˜ëŠ” `HELP` | ë©”ë‰´ ë‹¤ì‹œ í‘œì‹œ |

## ğŸ”„ ë™ì‘ ëª¨ë“œ

### Passive Mode (ê¸°ë³¸)
- ì•„ë‘ì´ë…¸ê°€ **2ì´ˆë§ˆë‹¤ ë°ì´í„°ë¥¼ ìš”ì²­**í•˜ë©´ ì„¼ì„œê°€ ì‘ë‹µ
- ì „ë ¥ ì†Œëª¨ê°€ ì ê³  ì•ˆì •ì 
- ë°ì´í„° ìˆ˜ì‹  ì‹¤íŒ¨ ì‹œ "Waiting for valid data..." ë©”ì‹œì§€ ì¶œë ¥

### Active Mode
- ì„¼ì„œê°€ **ì•½ 0.8~1ì´ˆë§ˆë‹¤ ìë™ìœ¼ë¡œ** ë°ì´í„° ì „ì†¡
- ì‹¤ì‹œê°„ ëª¨ë‹ˆí„°ë§ì— ì í•©
- ë°ì´í„° ìˆ˜ì‹  ì‹œë§ˆë‹¤ `[Active] PM1.0: X | PM2.5: Y | PM10: Z Âµg/mÂ³` í˜•íƒœë¡œ ì¶œë ¥
- **10ê°œ ë°ì´í„°ë§ˆë‹¤ ìë™ìœ¼ë¡œ ë©”ë‰´ ì¬í‘œì‹œ** (ì‚¬ìš©ì í¸ì˜ì„±)

### ëª¨ë“œ ì „í™˜
- `6`ë²ˆ ì…ë ¥ ì‹œ ì¦‰ì‹œ ëª¨ë“œ ì „í™˜
- ì „í™˜ í›„ ìë™ìœ¼ë¡œ ë©”ë‰´ ì¬í‘œì‹œ
- ì „í™˜ ì‹œ ë²„í¼ë¥¼ ë¹„ì›Œ ì´ì „ ëª¨ë“œì˜ ì”ì—¬ ë°ì´í„° ì œê±°

## ğŸ’¾ ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰
- `uint16_t pmHistory[3][150]` â†’ 3 Ã— 150 Ã— 2 byte = **900 byte**
- Arduino R4 WiFi(256 KB SRAM)ì— ì¶©ë¶„íˆ ë“¤ì–´ê°‘ë‹ˆë‹¤.

## âš ï¸ ì œí•œ ì‚¬í•­
- `ANALYZE`ëŠ” í˜„ì¬ êµ¬ê°„ í‰ê· ë§Œ ë³´ì—¬ì£¼ë©°, ì´ì „ êµ¬ê°„ê³¼ì˜ ë¹„êµëŠ” ë©”ëª¨ë¦¬ ì ˆì•½ì„ ìœ„í•´ êµ¬í˜„ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.
- Active Modeì—ì„œ ë„ˆë¬´ ë¹ ë¥¸ ì†ë„ë¡œ ëª…ë ¹ì„ ì…ë ¥í•˜ë©´ ë°ì´í„° ì¶œë ¥ì— ë¬»í ìˆ˜ ìˆìŠµë‹ˆë‹¤. (10ê°œë§ˆë‹¤ ë©”ë‰´ê°€ ì¬í‘œì‹œë˜ë¯€ë¡œ ê·¸ë•Œ ì…ë ¥ ê¶Œì¥)
- ì¶”ê°€ ê¸°ëŠ¥(ì•ŒëŒ, LED, SD ì¹´ë“œ ë“±)ì€ êµ¬í˜„ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.

## ğŸ¯ ì‚¬ìš© ì˜ˆì‹œ

### ì˜ˆì‹œ 1: í˜„ì¬ PM2.5 ê°’ í™•ì¸
```
ì…ë ¥: 2
ì¶œë ¥: [Current] PM 2.5 : 15 Âµg/mÂ³
      [Mode: Passive]
```

### ì˜ˆì‹œ 2: ëª¨ë“  PM ê°’ í™•ì¸
```
ì…ë ¥: 4
ì¶œë ¥: [Current] PM 1.0: 12 | PM 2.5: 15 | PM 10: 18
      [Mode: Passive]
```

### ì˜ˆì‹œ 3: Active Modeë¡œ ì „í™˜
```
ì…ë ¥: 6
ì¶œë ¥: >> Switched to ACTIVE Mode.
      (Sensor sends data automatically every ~1s)
      
      [ë©”ë‰´ ìë™ í‘œì‹œ]
      
ì´í›„ ìë™ ì¶œë ¥:
[Active] PM1.0: 12 | PM2.5: 15 | PM10: 18 Âµg/mÂ³
[Active] PM1.0: 13 | PM2.5: 16 | PM10: 19 Âµg/mÂ³
...
(10ê°œë§ˆë‹¤ ë©”ë‰´ ì¬í‘œì‹œ)
```

### ì˜ˆì‹œ 4: ìµœê·¼ 20ì´ˆ ë°ì´í„° í™•ì¸
```
ì…ë ¥: 5
ì¶œë ¥: 
--- Recent 20s Data (Last 10 Samples) ---
Idx	PM1.0	PM2.5	PM10
1	12	15	18
2	13	16	19
...
---------------------------------------------
 [Mode: Passive]
```

## ğŸ“š ì°¸ê³  ë¬¸ì„œ
- [docs/pms7003/pms7003_communication.md](file:///E:/arduino/01_project/5_%EA%B3%B5%EA%B8%B0%EC%A7%88_%EB%94%B0%EB%9D%BC%ED%95%98%EA%B8%B0/%EA%B3%B5%EA%B8%B0%EC%A7%88_pms7003_dht22/docs/pms7003/pms7003_communication.md) â€“ í†µì‹  í”„ë¡œí† ì½œ ìƒì„¸
- [docs/pms7003/pms7003_attentions.md](file:///E:/arduino/01_project/5_%EA%B3%B5%EA%B8%B0%EC%A7%88_%EB%94%B0%EB%9D%BC%ED%95%98%EA%B8%B0/%EA%B3%B5%EA%B8%B0%EC%A7%88_pms7003_dht22/docs/pms7003/pms7003_attentions.md) â€“ íšŒë¡œÂ·ì„¤ì¹˜ ì£¼ì˜ì‚¬í•­

## ğŸ”§ ê¸°ìˆ ì  íŠ¹ì§•
- **HardwareSerial (Serial1)** ì‚¬ìš©ìœ¼ë¡œ ì•ˆì •ì ì¸ 3.3V ë¡œì§ ë ˆë²¨ í†µì‹ 
- **1000ms íƒ€ì„ì•„ì›ƒ** ì„¤ì •ìœ¼ë¡œ ì•ˆì •ì ì¸ íŒ¨í‚· ìˆ˜ì‹ 
- **ë²„í¼ í´ë¦¬ì–´** ë¡œì§ìœ¼ë¡œ ë…¸ì´ì¦ˆ ë° ì”ì—¬ ë°ì´í„° ì œê±°
- **ìˆœí™˜ ë²„í¼** êµ¬ì¡°ë¡œ ë©”ëª¨ë¦¬ íš¨ìœ¨ì  ë°ì´í„° ì €ì¥
- **ëª¨ë“œë³„ ìµœì í™”ëœ ë£¨í”„ ì§€ì—°** (Passive: 2ì´ˆ, Active: 100ms)

---

**Enjoy!** ğŸ‰  
Feel free to modify the command set, storage size, or add features like SD card logging, OLED display, or WiFi data transmission to suit your own project.
