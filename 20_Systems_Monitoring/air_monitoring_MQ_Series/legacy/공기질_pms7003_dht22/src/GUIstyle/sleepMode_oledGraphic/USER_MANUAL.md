# PMS7003 OLED 공기질 측정기 사용 설명서

이 문서는 아두이노 Uno R4 WiFi, PMS7003 센서, OLED 디스플레이, 로터리 인코더를 사용한 공기질 측정기(`u8g2libStyle.ino`)의 설치 및 사용 방법을 설명합니다.

## 1. 하드웨어 구성 (Hardware Setup)

### 필요 부품
*   **MCU**: Arduino Uno R4 WiFi
*   **센서**: PMS7003 (미세먼지 센서)
*   **디스플레이**: 0.96인치 OLED (SSD1306, I2C 방식)
*   **입력 장치**: 로터리 인코더 (Rotary Encoder) 모듈

### 연결 배선도 (Wiring)

| 부품 (Component) | 핀 이름 (Pin) | 아두이노 연결 (Arduino Pin) | 비고 |
| :--- | :--- | :--- | :--- |
| **PMS7003** | VCC | 5V | |
| | GND | GND | |
| | TX | **0 (RX)** | Serial1 RX |
| | RX | **1 (TX)** | Serial1 TX |
| **OLED** | VCC | 3.3V 또는 5V | 모듈 사양 확인 |
| | GND | GND | |
| | SCL | SCL | I2C Clock |
| | SDA | SDA | I2C Data |
| **Rotary Encoder** | VCC | 5V | |
| | GND | GND | |
| | CLK | **2** | 디지털 입력 |
| | DT | **3** | 디지털 입력 |
| | SW | **4** | 스위치 입력 |

> [!IMPORTANT]
> PMS7003 연결 시 TX와 RX를 교차해서 연결해야 합니다 (센서 TX -> 아두이노 RX).

---

## 2. 조작 방법 (Controls)

로터리 인코더 하나로 모든 기능을 제어합니다.

*   **돌리기 (Rotate)**: 화면 전환 또는 메뉴 이동
    *   시계 방향: 다음 화면 / 아래로 이동 / 값 증가
    *   반시계 방향: 이전 화면 / 위로 이동 / 값 감소
*   **누르기 (Click)**: 선택 또는 확인
    *   설정 메뉴에서 값을 선택할 때 사용
    *   화면이 꺼져 있을 때 누르면 즉시 켜짐

---

## 3. 화면 구성 (Screens)

로터리 인코더를 돌려 4가지 화면을 순환할 수 있습니다.

### 1. 모니터 화면 (Monitor View) - *기본 화면*
*   **PM2.5**: 화면 중앙에 큰 글씨로 표시 (단위: ug/m3).
*   **PM1.0 / PM10**: 우측에 작은 글씨로 표시.
*   **상태바**: 상단에 현재 상태(ACTIVE/SLEEP)와 남은 시간 표시.

### 2. 그래프 화면 (Graph View)
*   미세먼지 농도를 막대 그래프로 시각화합니다.
*   **패턴 구분**:
    *   **PM1.0**: 꽉 찬 막대 (Solid)
    *   **PM2.5**: 빗금 무늬 (Hatched)
    *   **PM10**: 점 무늬 (Dotted)

### 3. 통계 화면 (Stats View)
*   전원 켜진 이후 공기질이 나빴던 횟수를 기록합니다.
*   **Events (>35)**: PM2.5가 35(나쁨)를 초과한 횟수.
*   **Danger (>75)**: PM2.5가 75(매우 나쁨)를 초과한 횟수.

### 4. 설정 메뉴 (Settings)
*   센서의 **휴식 시간(Sleep Interval)**을 변경합니다.
*   **Now**: 현재 적용 중인 휴식 시간.
*   **Set**: 다음 휴식 주기부터 적용될 시간 (예약).
*   옵션: 1분, 3분, 5분, 10분, 20분.
*   사용법: 원형 노브를 돌려 원하는 시간을 선택하고, 꾹 눌러서 예약합니다. 변경된 시간은 **다음 번 절전 모드 진입 시**부터 적용됩니다.

---

## 4. 주요 기능 (Features)

### 자동 절전 모드 (Auto Sleep Mode)
센서 수명 보호를 위해 주기적으로 센서를 끄고 켭니다.
1.  **측정 (Active)**: 30초 동안 팬을 돌리며 공기질을 측정합니다.
2.  **휴식 (Sleep)**: 설정된 시간(기본 1분) 동안 센서 전원을 끕니다.
    *   상단 상태바에 `SLEEP`과 남은 시간(초)이 표시됩니다.
    *   휴식 시간이 끝나면 자동으로 다시 측정 모드로 돌아옵니다.

### 화면 보호기 (Screen Saver)
OLED 번인(Burn-in) 방지를 위한 기능입니다.
*   **동작**: 60초 동안 아무런 조작이 없으면 화면이 자동으로 꺼집니다.
*   **해제**: 로터리 인코더를 돌리거나 누르면 즉시 화면이 켜집니다. (버튼 클릭 시 화면만 켜지고 메뉴 선택은 되지 않습니다.)

---

## 5. 문제 해결 (Troubleshooting)

**Q. 화면에 아무것도 안 나와요.**
*   배선이 올바른지 확인하세요 (특히 VCC, GND).
*   화면 보호기가 켜진 것일 수 있으니 버튼을 눌러보세요.

**Q. 미세먼지 수치가 계속 0이에요.**
*   PMS7003의 TX/RX 연결이 반대로 되지 않았는지 확인하세요.
*   센서 팬이 돌아가는 소리가 들리는지 확인하세요.

**Q. 버튼이 잘 안 눌려요.**
*   로터리 인코더 모듈의 핀 연결이 헐겁지 않은지 확인하세요.
*   코드상의 핀 번호(2, 3, 4)와 실제 연결이 일치하는지 확인하세요.
