# Nextion Serial Bridge (Arduino R4 WiFi) 가이드

이 문서는 Arduino R4 WiFi를 사용하여 PC(Nextion Editor)와 Nextion 디스플레이 사이의 시리얼 브릿지를 구축하고 프로젝트 펌웨어를 업로드하는 방법을 설명합니다.

## 🚀 주요 특징 (offcircuit/Nextion 라이브러리 분석 기반)

기존 브릿지 코드에서 발생하던 연결 실패 문제를 해결하기 위해 다음 로직이 포함되어 있습니다.

1. **강제 연결 시퀀스 (Wake-up Sequence)**
   - 디스플레이가 대기 모드이거나 통신 상태가 불안정할 때를 대비하여 `DRAKJHSUYDGBNCJHGJKSHBDN` 및 `connect` 명령어를 포함한 라이브러리 표준 웨이크업 시퀀스를 실행합니다.

2. **안정적인 데이터 패스스루**
   - 불필요한 속도 감지 로직을 제거하고, 기본 속도(9600)에서 안정적으로 데이터를 주고받도록 구성되었습니다.
   - Nextion Editor에서 업로드 속도를 설정할 때 자동으로 감지가 되지 않는다면, 코드의 `Serial1.begin(9600)` 부분을 Editor에서 설정한 속도와 동일하게 맞춘 후 다시 업로드하십시오.

## 🔌 하드웨어 연결 방법

| Nextion 핀 | Arduino R4 WiFi 핀 | 비고                                     |
| :--------- | :----------------- | :--------------------------------------- |
| **TX**     | **D0 (RX)**        | 데이터 수신                              |
| **RX**     | **D1 (TX)**        | 데이터 송신                              |
| **GND**    | **GND**            | 공통 접지                                |
| **+5V**    | **5V / 외부전원**  | 3.5인치 이상 모델은 가급적 외부전원 권장 |

## 🛠 사용 방법

1. [bridgeWithNextion.ino](bridgeWithNextion.ino) 코드를 Arduino R4 WiFi에 업로드합니다.
2. Nextion Editor를 실행하고 `Upload` 버튼을 누릅니다.
3. 올바른 **COM 포트**를 선택한 후 `Go`를 누릅니다.
4. (중요) 업로드 중에는 VS Code의 시리얼 모니터 등 다른 시리얼 통신 프로그램을 반드시 종료해야 합니다.

## 🔍 문제 해결 (Troubleshooting)

- **Connection failed**: 
  - RX/TX 배선이 바뀌지 않았는지 확인하십시오 (TX-RX, RX-TX).
  - 다른 프로그램이 시리얼 포트를 사용하고 있는지 확인하십시오.
  - 전력 부족 문제일 수 있으니 디스플레이에 전원을 충분히 공급하십시오.
- **업로드 속도**: 
  - Nextion Editor에서 속도를 `Auto`로 두거나, 감지가 잘 안 될 경우 `9600`부터 단계적으로 올려보십시오.

---

## 🛠 방식 비교: 직접 연결(Bypass) vs 라이브러리 개발

개발 효율을 높이기 위해 상황에 맞는 개발 방식을 선택하는 것이 중요합니다.

### 1. 직접 연결 (Bypass / Debug 모드) - 현재 사용 중인 방식
아두이노가 PC의 신호를 디스플레이로 통과만 시켜주는 상태입니다.

| 장점                                           | 단점                                             |
| :--------------------------------------------- | :----------------------------------------------- |
| **Nextion Editor와 실시간 동기화**가 가능함    | 아두이노의 독립적인 로직(센서 읽기 등) 실행 불가 |
| 에디터에서 클릭/타이핑만으로 화면 즉시 제어    | 개발자가 수동으로 명령을 내려야 함               |
| **GUI 디자인(위치, 폰트, 색상) 단계에서 필수** | -                                                |

### 2. 라이브러리 방식 (Nextion.h) - 최종 배포용
아두이노가 주체가 되어 디스플레이와 대화하는 상태입니다.

| 장점                                          | 단점                                        |
| :-------------------------------------------- | :------------------------------------------ |
| **자동화:** 센서 값에 따라 화면이 스스로 변함 | 코드 수정마다 업로드가 필요하여 속도가 느림 |
| 이벤트 처리(버튼 클릭 시 특정 동작)가 강력함  | 배선 및 라이브러리 설정이 복잡할 수 있음    |
| **최종 시스템(mainrev06 등) 구축 단계**       | -                                           |

---

## 💡 개발 가이드라인 (추천 방식)

가장 효율적인 개발 순서는 다음과 같습니다:

1.  **디자인 단계 (Bypass 모드):** 바이패스 코드를 사용하여 화면 레이아웃을 잡고, 에디터의 `Debug` 기능으로 명령어 결과가 화면에 잘 나오는지 확인합니다.
2.  **업로드:** 바이패스 상태에서 에디터의 `Upload` 기능을 통해 `.tft` 파일을 LCD에 굽습니다.
3.  **최종 구현 (라이브러리 모드):** 화면 디자인이 완료되면 아두이노 본 코드를 작성하고 라이브러리를 통해 실제 데이터를 전송합니다.

현재는 **Bypass 모드로 화면 디자인 및 명령어 테스트**를 끝내는 단계에 집중하는 것이 가장 빠릅니다.
