# 진행 로그 (Progress Log)

## 목적
- 01 → 02 전환 과정에서 발생한 오류와 수정 사항을 기록
- 향후 작업 진행 상황을 수시로 기록

---

## 2026-01-30

### 01 → 02 전환 중 발생한 주요 오류

1. **중복 정의 오류 (redefinition)**
   - 증상: `prevUpdateMillis`, `setup()`, `loop()` 등이 중복 정의되어 컴파일 실패
   - 원인: 서로 다른 코드 블록이 한 파일에 병합되며 중복 선언 발생
   - 조치: 중복 코드 블록을 제거하고 단일 구조로 정리

2. **그래프 미표시 문제**
   - 증상: `01`에서는 웨이브폼 및 숫자 표시 정상, `02`에서는 표시 안 됨
   - 원인: `02`에서 `SoftwareSerial + nexInit()` 기반으로 변경되며 R4 WiFi(Serial1) 환경과 충돌
   - 조치: `01`과 동일한 **Serial1 직접 명령 방식**으로 복원

3. **화면 보호기 기능 적용 위치 문제**
   - 요구사항: 화면 보호기는 지속 동작해야 하므로 `loop()`에서 관리 필요
   - 조치: 보호기 설정을 `loop()`에서 1회 적용되도록 함수화하여 반영

4. **delay 제거 요구**
   - 요구사항: `delay()` 없이 동작하도록 리팩토링
   - 조치: `millis()` 기반 비차단 타이머 로직으로 업데이트 루프 구성

5. **그래프 표시 방식 개선 (직선/간격 요구 반영)**
   - 요구사항: 온도 샘플 간 직선으로 표시, 샘플 간 가로 간격 유지
   - 조치: 점-점 보간(선형) 로직을 적용하고 `LINE_STEPS`로 가로 폭 제어
   - 변경: 보간 단계 수를 조정하여 샘플 1개당 20칸 폭으로 표시

---

## 2026-01-31

### main001_nextion_04.ino 듀얼 스테이트 버튼 및 웨이브폼 동작 변경

1. **멀티 채널 선택 지원**
   - 증상: 기존 로직은 단일 채널만 선택 가능
   - 원인: `currentChannelMode` 기반 단일 선택 구조
   - 조치: `activeChannels[]` 기반 멀티 선택 구조로 변경, bt0~bt3 독립 토글, bt4는 전체 ON/OFF 토글
   - 파일: [src/main/mainrev07_tftlcd/main001_nextion_04.ino](src/main/mainrev07_tftlcd/main001_nextion_04.ino)

2. **채널 OFF 시 화면에서 제거**
   - 요구사항: 비활성화 시 해당 채널 그래프가 보이지 않도록 처리
   - 조치: 채널 OFF 시 `cle <waveformId>,<channel>` 호출로 해당 채널만 지움
   - 파일: [src/main/mainrev07_tftlcd/main001_nextion_04.ino](src/main/mainrev07_tftlcd/main001_nextion_04.ino)

3. **늦게 활성화된 채널 동기화**
   - 증상: 늦게 켠 채널이 과거 시점부터 그려져 시점이 뒤쳐짐
   - 조치: 채널 ON 시 `cle` 후 `lastPlotValues[ch] = -1`로 초기화하여 현재 시점부터 그리기
   - 결과: 늦게 활성화된 채널도 동일 시점 기준으로 그려짐
   - 파일: [src/main/mainrev07_tftlcd/main001_nextion_04.ino](src/main/mainrev07_tftlcd/main001_nextion_04.ino)

## 다음 진행 계획

- [x] 화면 보호기 동작 테스트 (절전/터치 복귀 확인)
- [ ] 웨이브폼 및 Xfloat 동시 출력 안정성 검증
- [ ] UI/UX 개선 항목 추가 반영 (밝기 조절, 화면 전환 버튼, 채널 선택 UI)

---

## 로그 작성 규칙
- 날짜별로 추가
- 증상/원인/조치 순서로 기록
- 변경된 파일과 적용된 이유 명시
